<div id="page-wrapper">
<div class="container-fluid">
<div class="page-title"><?= $page_title ?></div>
<div class="content">
	<div class="tabs" data-id="asd">
		<div class="tabs-header">
			<div class="tabs-item-container">
				<div class="tabs-item active" data-tabs-number="1">Konfirmasi (<span class="tabs-item-count">0</span>)</div>
				<div class="tabs-item" data-tabs-number="2">Pending (<span class="tabs-item-count">0</span>)</div>
				<div class="tabs-item" data-tabs-number="3">Pesanan (<span class="tabs-item-count">0</span>)</div>
				<div class="tabs-item" data-tabs-number="4">Dikirim (<span class="tabs-item-count">0</span>)</div>
				<div class="tabs-item" data-tabs-number="5">Diambil (<span class="tabs-item-count">0</span>)</div>
				<div class="tabs-item" data-tabs-number="6">Diterima (<span class="tabs-item-count">0</span>)</div>
				<div class="tabs-item" data-tabs-number="7">Selesai (<span class="tabs-item-count">0</span>)</div>
				<div class="tabs-item" data-tabs-number="8">Cancel (<span class="tabs-item-count">0</span>)</div>
			</div>
			<div class="tabs-selection"></div>
		</div>
		<div class="tabs-body">
			<div class="tabs-content active" data-tabs-number="1">
				<div class="table-container">
					<table class="table table-kiriman">
						<thead>
							<tr>
								<td data-col='nama-kirim'>Nama Kirim</td>
								<td data-col='harga'>Harga</td>
								<td data-col='asal'>Asal</td>
								<td data-col='tujuan'>Tujuan</td>
								<td data-align="center" data-col='km'>KM</td>
								<td data-align="center" data-col='action'>Action</td>
							</tr>
						</thead>
						<tbody class="tbody-kiriman">
						</tbody>
					</table>
					<div class="table-empty-state shown">tidak ada data</div>
				</div>
			</div>
			<div class="tabs-content" data-tabs-number="2">
				<div class="table-container">
					<table class="table table-kiriman">
						<thead>
							<tr>
								<td data-col='nama-kirim'>Nama Kirim</td>
								<td data-col='harga'>Harga</td>
								<td data-col='asal'>Asal</td>
								<td data-col='tujuan'>Tujuan</td>
								<td data-align="center" data-col='km'>KM</td>
								<td data-col='muatan'>Muatan</td>
								<td data-col='supir'>Supir</td>
								<td data-col='kendaraan'>Kendaraan</td>
								<td data-col='lacak'>Lacak</td>
								<td data-align="center" data-col='action'>Action</td>
							</tr>
						</thead>
						<tbody class="tbody-kiriman">
						</tbody>
					</table>
					<div class="table-empty-state shown">tidak ada data</div>
				</div>
			</div>
			<div class="tabs-content" data-tabs-number="3">
				<div class="table-container">
					<table class="table table-kiriman">
						<thead>
							<tr>
								<td data-col='nama-kirim'>Nama Kirim</td>
								<td data-col='harga'>Harga</td>
								<td data-col='asal'>Asal</td>
								<td data-col='tujuan'>Tujuan</td>
								<td data-align="center" data-col='km'>KM</td>
								<td data-col='muatan'>Muatan</td>
								<td data-col='supir'>Supir</td>
								<td data-col='kendaraan'>Kendaraan</td>
								<td data-col='lacak'>Lacak</td>
								<td data-align="center" data-col='action'>Action</td>
							</tr>
						</thead>
						<tbody class="tbody-kiriman">
						</tbody>
					</table>
					<div class="table-empty-state shown">tidak ada data</div>
				</div>
			</div>
			<div class="tabs-content" data-tabs-number="4">
				<div class="table-container">
					<table class="table table-kiriman">
						<thead>
							<tr>
								<td data-col='nama-kirim'>Nama Kirim</td>
								<td data-col='harga'>Harga</td>
								<td data-col='asal'>Asal</td>
								<td data-col='tujuan'>Tujuan</td>
								<td data-align="center" data-col='km'>KM</td>
								<td data-col='muatan'>Muatan</td>
								<td data-col='supir'>Supir</td>
								<td data-col='kendaraan'>Kendaraan</td>
								<td data-col='lacak'>Lacak</td>
								<td data-align="center" data-col='action'>Action</td>
							</tr>
						</thead>
						<tbody class="tbody-kiriman">
						</tbody>
					</table>
					<div class="table-empty-state shown">tidak ada data</div>
				</div>
			</div>
			<div class="tabs-content" data-tabs-number="5">
				<div class="table-container">
					<table class="table table-kiriman">
						<thead>
							<tr>
								<td data-col='nama-kirim'>Nama Kirim</td>
								<td data-col='harga'>Harga</td>
								<td data-col='asal'>Asal</td>
								<td data-col='tujuan'>Tujuan</td>
								<td data-align="center" data-col='km'>KM</td>
								<td data-col='muatan'>Muatan</td>
								<td data-col='supir'>Supir</td>
								<td data-col='kendaraan'>Kendaraan</td>
								<td data-col='lacak'>Lacak</td>
								<td data-align="center" data-col='action'>Action</td>
							</tr>
						</thead>
						<tbody class="tbody-kiriman">
						</tbody>
					</table>
					<div class="table-empty-state shown">tidak ada data</div>
				</div>
			</div>
			<div class="tabs-content" data-tabs-number="6">
				<div class="table-container">
					<table class="table table-kiriman">
						<thead>
							<tr>
								<td data-col='nama-kirim'>Nama Kirim</td>
								<td data-col='harga'>Harga</td>
								<td data-col='asal'>Asal</td>
								<td data-col='tujuan'>Tujuan</td>
								<td data-align="center" data-col='km'>KM</td>
								<td data-col='muatan'>Muatan</td>
								<td data-col='supir'>Supir</td>
								<td data-col='kendaraan'>Kendaraan</td>
								<td data-col='lacak'>Lacak</td>
							</tr>
						</thead>
						<tbody class="tbody-kiriman">
						</tbody>
					</table>
					<div class="table-empty-state shown">tidak ada data</div>
				</div>
			</div>
			<div class="tabs-content" data-tabs-number="7">
				<div class="table-container">
					<table class="table table-kiriman">
						<thead>
							<tr>
								<td data-col='nama-kirim'>Nama Kirim</td>
								<td data-col='harga'>Harga</td>
								<td data-col='asal'>Asal</td>
								<td data-col='tujuan'>Tujuan</td>
								<td data-align="center" data-col='km'>KM</td>
								<td data-col='muatan'>Muatan</td>
								<td data-col='supir'>Supir</td>
								<td data-col='kendaraan'>Kendaraan</td>
								<td data-col='lacak'>Lacak</td>
								<td data-align="center" data-col='waktu-kiriman'>Waktu Kiriman</td>
								<td data-align="center" data-col='total-waktu'>Total Waktu</td>
							</tr>
						</thead>
						<tbody class="tbody-kiriman">
						</tbody>
					</table>
					<div class="table-empty-state shown">tidak ada data</div>
				</div>
			</div>
			<div class="tabs-content" data-tabs-number="8">
				<div class="table-container">
					<table class="table table-kiriman">
						<thead>
							<tr>
								<td data-col='nama-kirim'>Nama Kirim</td>
								<td data-col='harga'>Harga</td>
								<td data-col='asal'>Asal</td>
								<td data-col='tujuan'>Tujuan</td>
								<td data-align="center" data-col='km'>KM</td>
								<td data-col='cancel-by'>Cancel by</td>
							</tr>
						</thead>
						<tbody class="tbody-kiriman">
						</tbody>
					</table>
					<div class="table-empty-state shown">tidak ada data</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="dialog-background">
	<div class="dialog dialog-konfirmasi-deal-kiriman">
		<div class="dialog-header">
			<div class="dialog-header-close-btn" style="background-image: url(<?php echo base_url("assets/icons/close_icon.svg"); ?>);"></div>
			<div class="dialog-title">Konfirmasi Kiriman</div>
		</div>
		<div class="dialog-body">
			<div></div>
		</div>
		<div class="dialog-footer">
			<button type="button" class="btn-default btn-submit-deal-kiriman">Konfirmasi</button>
			<button type="button" class="btn-neutral btn-batal">Tidak Jadi</button>
		</div>
	</div>
</div>
<div class="dialog-background">
	<div class="dialog dialog-konfirmasi-pesan-kiriman">
		<div class="dialog-header">
			<div class="dialog-header-close-btn" style="background-image: url(<?php echo base_url("assets/icons/close_icon.svg"); ?>);"></div>
			<div class="dialog-title">Konfirmasi Pesan Kiriman</div>
		</div>
		<div class="dialog-body">
			<div></div>
		</div>
		<div class="dialog-footer">
			<button type="button" class="btn-default btn-submit-pesan-kiriman">Pesan</button>
			<button type="button" class="btn-neutral btn-batal">Tidak Jadi</button>
		</div>
	</div>
</div>
<div class="dialog-background">
	<div class="dialog dialog-konfirmasi-kirim-kiriman">
		<div class="dialog-header">
			<div class="dialog-header-close-btn" style="background-image: url(<?php echo base_url("assets/icons/close_icon.svg"); ?>);"></div>
			<div class="dialog-title">Konfirmasi Kirim Kiriman</div>
		</div>
		<div class="dialog-body">
			<div></div>
		</div>
		<div class="dialog-footer">
			<button type="button" class="btn-default btn-submit-kirim-kiriman">Dikirim</button>
			<button type="button" class="btn-neutral btn-batal">Tidak Jadi</button>
		</div>
	</div>
</div>
<div class="dialog-background">
	<div class="dialog dialog-konfirmasi-ambil-kiriman">
		<div class="dialog-header">
			<div class="dialog-header-close-btn" style="background-image: url(<?php echo base_url("assets/icons/close_icon.svg"); ?>);"></div>
			<div class="dialog-title">Konfirmasi Ambil Kiriman</div>
		</div>
		<div class="dialog-body">
			<div></div>
		</div>
		<div class="dialog-footer">
			<button type="button" class="btn-default btn-submit-ambil-kiriman">Diambil</button>
			<button type="button" class="btn-neutral btn-batal">Tidak Jadi</button>
		</div>
	</div>
</div>
<div class="dialog-background">
	<div class="dialog dialog-konfirmasi-terima-kiriman">
		<div class="dialog-header">
			<div class="dialog-header-close-btn" style="background-image: url(<?php echo base_url("assets/icons/close_icon.svg"); ?>);"></div>
			<div class="dialog-title">Konfirmasi Terima Kiriman</div>
		</div>
		<div class="dialog-body">
			<div></div>
		</div>
		<div class="dialog-footer">
			<button type="button" class="btn-default btn-submit-terima-kiriman">Diterima</button>
			<button type="button" class="btn-neutral btn-batal">Tidak Jadi</button>
		</div>
	</div>
</div>
<div class="dialog-background">
	<div class="dialog dialog-konfirmasi-cancel-transaction">
		<div class="dialog-header">
			<div class="dialog-header-close-btn" style="background-image: url(<?php echo base_url("assets/icons/close_icon.svg"); ?>);"></div>
			<div class="dialog-title">Pembatalan Kiriman</div>
		</div>
		<div class="dialog-body">
			<div></div>
		</div>
		<div class="dialog-footer">
			<button type="button" class="btn-negative btn-submit-cancel-transaction">Batalkan Kiriman</button>
			<button type="button" class="btn-neutral btn-batal">Tidak Jadi</button>
		</div>
	</div>
</div>
</div>
</div>
<script>
var month = ["Jan", "Feb", "Mar", "Apr", "Mei", "Jun", "Jul", "Ags", "Sep", "Okt", "Nov", "Des"];
var profilUrl = "<?= base_url("profil/") ?>";
var kirimanUrl = [];
kirimanUrl[1] = "<?= base_url("kiriman-darat-ekspedisi/getDealKiriman") ?>";
kirimanUrl[2] = "<?= base_url("kiriman-darat-ekspedisi/getPendingKiriman") ?>";
kirimanUrl[3] = "<?= base_url("kiriman-darat-ekspedisi/getPesananKiriman") ?>";
kirimanUrl[4] = "<?= base_url("kiriman-darat-ekspedisi/getDikirimKiriman") ?>";
kirimanUrl[5] = "<?= base_url("kiriman-darat-ekspedisi/getDiambilKiriman") ?>";
kirimanUrl[6] = "<?= base_url("kiriman-darat-ekspedisi/getDiterimaKiriman") ?>";
kirimanUrl[7] = "<?= base_url("kiriman-darat-ekspedisi/getSelesaiKiriman") ?>";
kirimanUrl[8] = "<?= base_url("kiriman-darat-ekspedisi/getCancelKiriman") ?>";

var kirimanTabs = [];
kirimanTabs[1] = "deal";
kirimanTabs[2] = "pending";
kirimanTabs[3] = "pesanan";
kirimanTabs[4] = "dikirim";
kirimanTabs[5] = "diambil";
kirimanTabs[6] = "diterima";
kirimanTabs[7] = "selesai";
kirimanTabs[8] = "cancel";

var kendaraan = [], supir = [], alat = [];
	
$(function() {
	getKiriman(kirimanUrl[1], 1, "deal");
	getKirimanCount();
	
	$(".tabs-item").on("click", function() {
		var tabsNumber = $(this).data("tabs-number");
		getKiriman(kirimanUrl[tabsNumber], tabsNumber, kirimanTabs[tabsNumber]);
	});
	
	$(document).on("click", ".btn-deal", function() {
		var trKiriman = $(this).closest(".tr-kiriman");
		var shipment_id = trKiriman.data("id");
		var shipment_title = trKiriman.data("shipment-title");
		var shipment_from = trKiriman.data("asal");
		var shipment_to = trKiriman.data("tujuan");
		var shipment_length = trKiriman.find(".td-km").html();
		
		$(".dialog-konfirmasi-deal-kiriman").data("id", shipment_id);
		$(".dialog-konfirmasi-deal-kiriman .dialog-body").html("Nama Kiriman : " + shipment_title + "<br>Asal : " + shipment_from + "<br>Tujuan : " + shipment_to + "<br>Jarak : " + shipment_length + " Km");
		showDialog(".dialog-konfirmasi-deal-kiriman");
	});

	$(document).on("click", ".btn-submit-deal-kiriman", function() {
		submitDeal();
	});
	
	$(document).on("click", ".btn-pesan", function() {
		var trKiriman = $(this).closest(".tr-kiriman");
		var shipment_id = trKiriman.data("id");
		var shipment_title = trKiriman.data("shipment-title");
		var shipment_from = trKiriman.data("asal");
		var shipment_to = trKiriman.data("tujuan");
		var shipment_length = trKiriman.find(".td-km").html();
		var jenis_muatan = trKiriman.find(".select-jenis-muatan").val();
		var jenis_muatan_text = trKiriman.find(".select-jenis-muatan option:selected").text();
		var driver_id = trKiriman.find(".select-supir").val();
		var driver_id_text = trKiriman.find(".select-supir option:selected").text();
		var vehicle_id = trKiriman.find(".select-kendaraan").val();
		var vehicle_id_text = trKiriman.find(".select-kendaraan option:selected").text();
		var device_id = trKiriman.find(".select-alat").val();
		var device_id_text = trKiriman.find(".select-alat option:selected").text();

		$(".dialog-konfirmasi-pesan-kiriman").data("id", shipment_id);
		$(".dialog-konfirmasi-pesan-kiriman").data("jenis_muatan", jenis_muatan);
		$(".dialog-konfirmasi-pesan-kiriman").data("driver_id", driver_id);
		$(".dialog-konfirmasi-pesan-kiriman").data("vehicle_id", vehicle_id);
		$(".dialog-konfirmasi-pesan-kiriman").data("device_id", device_id);

		$(".dialog-konfirmasi-pesan-kiriman .dialog-body").html("Nama Kiriman : " + shipment_title + "<br>Asal : " + shipment_from + "<br>Tujuan : " + shipment_to + "<br>Jarak : " + shipment_length + " Km<br>Jenis Muatan : " + jenis_muatan_text + "<br>Supir : " + driver_id_text + "<br>Kendaraan : " + vehicle_id_text + "<br>Alat : " + device_id_text);
		showDialog(".dialog-konfirmasi-pesan-kiriman");
	});

	$(document).on("click", ".btn-submit-pesan-kiriman", function() {
		submitPesan();
	});
	
	$(document).on("click", ".btn-dikirim", function() {
		var trKiriman = $(this).closest(".tr-kiriman");
		var shipment_id = trKiriman.data("id");
		var shipment_title = trKiriman.data("shipment-title");
		var shipment_from = trKiriman.data("asal");
		var shipment_to = trKiriman.data("tujuan");
		var shipment_length = trKiriman.find(".td-km").html();
		var jenis_muatan = trKiriman.find(".td-jenis-muatan").html();
		var driver_name = trKiriman.find(".td-supir").html();
		var vehicle_name = trKiriman.find(".td-kendaraan").html();
		var device_name = trKiriman.find(".td-alat").html();

		$(".dialog-konfirmasi-kirim-kiriman").data("id", shipment_id);
		$(".dialog-konfirmasi-kirim-kiriman .dialog-body").html("Nama Kiriman : " + shipment_title + "<br>Asal : " + shipment_from + "<br>Tujuan : " + shipment_to + "<br>Jarak : " + shipment_length + " Km<br>Jenis Muatan : " + jenis_muatan + "<br>Supir : " + driver_name + "<br>Kendaraan : " + vehicle_name + "<br>Alat : " + device_name);
		showDialog(".dialog-konfirmasi-kirim-kiriman");
	});

	$(document).on("click", ".btn-submit-kirim-kiriman", function() {
		submitKirim();
	});
	
	$(document).on("click", ".btn-diambil", function() {
		var trKiriman = $(this).closest(".tr-kiriman");
		var shipment_id = trKiriman.data("id");
		var shipment_title = trKiriman.data("shipment-title");
		var shipment_from = trKiriman.data("asal");
		var shipment_to = trKiriman.data("tujuan");
		var shipment_length = trKiriman.find(".td-km").html();
		var jenis_muatan = trKiriman.find(".td-jenis-muatan").html();
		var driver_name = trKiriman.find(".td-supir").html();
		var vehicle_name = trKiriman.find(".td-kendaraan").html();
		var device_name = trKiriman.find(".td-alat").html();

		$(".dialog-konfirmasi-ambil-kiriman").data("id", shipment_id);
		$(".dialog-konfirmasi-ambil-kiriman .dialog-body").html("Nama Kiriman : " + shipment_title + "<br>Asal : " + shipment_from + "<br>Tujuan : " + shipment_to + "<br>Jarak : " + shipment_length + " Km<br>Jenis Muatan : " + jenis_muatan + "<br>Supir : " + driver_name + "<br>Kendaraan : " + vehicle_name + "<br>Alat : " + device_name);
		showDialog(".dialog-konfirmasi-ambil-kiriman");
	});

	$(document).on("click", ".btn-submit-ambil-kiriman", function() {
		submitAmbil();
	});
	
	$(document).on("click", ".btn-diterima", function() {
		var trKiriman = $(this).closest(".tr-kiriman");
		var shipment_id = trKiriman.data("id");
		var shipment_title = trKiriman.data("shipment-title");
		var shipment_from = trKiriman.data("asal");
		var shipment_to = trKiriman.data("tujuan");
		var shipment_length = trKiriman.find(".td-km").html();
		var jenis_muatan = trKiriman.find(".td-jenis-muatan").html();
		var driver_name = trKiriman.find(".td-supir").html();
		var vehicle_name = trKiriman.find(".td-kendaraan").html();
		var device_name = trKiriman.find(".td-alat").html();

		$(".dialog-konfirmasi-terima-kiriman").data("id", shipment_id);
		$(".dialog-konfirmasi-terima-kiriman .dialog-body").html("Nama Kiriman : " + shipment_title + "<br>Asal : " + shipment_from + "<br>Tujuan : " + shipment_to + "<br>Jarak : " + shipment_length + " Km<br>Jenis Muatan : " + jenis_muatan + "<br>Supir : " + driver_name + "<br>Kendaraan : " + vehicle_name + "<br>Alat : " + device_name);
		showDialog(".dialog-konfirmasi-terima-kiriman");
	});

	$(document).on("click", ".btn-submit-terima-kiriman", function() {
		submitTerima();
	});
	
	$(document).on("click", ".btn-batal-pengiriman", function() {
		var shipment_id = $(this).closest(".tr-kiriman").data("id");
		var shipment_title = $(this).closest(".tr-kiriman").data("shipment-title");
		
		$(".dialog-konfirmasi-cancel-transaction").data("shipment_id", shipment_id);
		$(".dialog-konfirmasi-cancel-transaction .dialog-body").html("Batalkan kiriman " + shipment_title + "?");
		showDialog(".dialog-konfirmasi-cancel-transaction");
	});
	
	$(".btn-submit-cancel-transaction").on("click", function() {
		cancelShipment();
	});

	$(document).on("click", ".tabs-content:not([data-tabs-number='7']):not([data-tabs-number='8']) .btn-view-kontak", function() {
		var tr = $(this).closest(".tr-kiriman");
		var detailElement = $(tr).next();
		if ($(detailElement).height() == 0) {
			$(detailElement).addClass("show");
			if ($(detailElement).find(".row-detail-td-content").html().trim() == "") {
				getDetailPengirim(tr);
			}
		} else {
			$(detailElement).removeClass("show");
		}
	});

	$(document).on("click", ".tabs-content[data-tabs-number='7'] .btn-view-kontak", function() {
		var tr = $(this).closest(".tr-kiriman");
		var detailElement = $(tr).next();
		if (detailElement.height() == 0) {
			detailElement.addClass("show");
			if (detailElement.find(".row-detail-td-content").html().trim() == "") {
				getAllStatusKiriman(tr, detailElement);
			}
		} else {
			detailElement.removeClass("show");
		}
	});
});

function getAllStatusKiriman(tr, element) {
	var shipment_id = $(tr).data("id");
	ajaxCall("<?= base_url("kiriman-darat-ekspedisi/getAllStatusKiriman") ?>", {shipment_id: shipment_id}, function(json) {
		var result = JSON.parse(json);
		if (result.status == "success") {
			var status_0 = result.pending_date;
			var status_1 = result.confirmation_date;
			var status_2, status_2_name, status_3, status_3_name, status_4, status_4_name, status_5, status_5_name;
			status_2 = result.order_date;
			status_2_name = "Pesanan";
			status_3 = result.delivery_date;
			status_3_name = "Dikirim";
			status_4 = result.pickup_date;
			status_4_name = "Diambil";
			status_5 = result.receive_date;
			status_5_name = "Diterima";
			var status_6 = result.end_date;

			var content = "";
			content += "<div class='detail-status'>";
			content += "<div class='detail-status-title'>Status</div>";
			content += "<div class='status-item'><span class='status-badge' data-status='0'>Pending</span><span class='status-time'>" + status_0 + "</span></div>";
			content += '<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>';
			content += "<div class='status-item'><span class='status-badge' data-status='1'>Konfirmasi</span><span class='status-time'>" + status_1 + "</span></div>";
			content += '<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>';
			content += "<div class='status-item'><span class='status-badge' data-status='2'>" + status_2_name + "</span><span class='status-time'>" + status_2 + "</span></div>";
			content += '<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>';
			content += "<div class='status-item'><span class='status-badge' data-status='3'>" + status_3_name + "</span><span class='status-time'>" + status_3 + "</span></div>";
			content += '<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>';
			content += "<div class='status-item'><span class='status-badge' data-status='4'>" + status_4_name + "</span><span class='status-time'>" + status_4 + "</span></div>";
			content += '<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>';
			content += "<div class='status-item'><span class='status-badge' data-status='5'>" + status_5_name + "</span><span class='status-time'>" + status_5 + "</span></div>";
			content += '<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>';
			content += "<div class='status-item'><span class='status-badge' data-status='6'>Selesai</span><span class='status-time'>" + status_6 + "</span></div>";
			content += "</div>";
			$(element).find(".row-detail-td-content").html(content);
		}
	});
}

function getDetailPengirim(element) {
	var shipment_id = $(element).data("id");
	
	ajaxCall("<?= base_url("kiriman-darat-ekspedisi/getDetailPengirim") ?>", {shipment_id: shipment_id}, function(json) {
		
		var result = jQuery.parseJSON(json);
		var content = "";
		content += "<div class='detail-col'>";
		content += "<div class='detail-title'>Info Pemilik Barang</div>";
		content += "<div class='detail-row'><span class='detail-label'>Nama</span><span class='detail-titikdua'> : </span><span class='detail-value'>" + result["user_fullname"] + "</span></div>";
		content += "<div class='detail-row'><span class='detail-label'>Alamat</span><span class='detail-titikdua'> : </span><span class='detail-value'>" + result["user_address"] + "</span></div>";
		content += "<div class='detail-row'><span class='detail-label'>Telepon</span><span class='detail-titikdua'> : </span><span class='detail-value'>" + result["user_telephone"] + "</span></div>";
		content += "<div class='detail-row'><span class='detail-label'>Handphone</span><span class='detail-titikdua'> : </span><span class='detail-value'>" + result["user_handphone"] + "</span></div>";
		content += "</div>";

		var status_0 = result["pending_date"];
		var status_1 = result["confirmation_date"];
		var status_2, status_2_name, status_3, status_3_name, status_4, status_4_name, status_5, status_5_name;

		status_2 = result["order_date"];
		status_2_name = "Pesanan";
		status_3 = result["delivery_date"];
		status_3_name = "Dikirim";
		status_4 = result["pickup_date"];
		status_4_name = "Diambil";
		status_5 = result["receive_date"];
		status_5_name = "Diterima";

		var jenis_muatan = (result["shipment_jenis_muatan"] == 1) ? "Penuh" : "Parsial";

		if (result["shipment_status"] > 1) {
			content += "<div class='detail-col'>";
			content += "<div class='detail-title'>Detail Kiriman</div>";
			content += "<div class='detail-row'><span class='detail-label'>Jenis Muatan</span><span class='detail-titikdua'> : </span><span class='detail-value'>" + jenis_muatan + "</span></div>";
			content += "<div class='detail-row'><span class='detail-label'>Supir</span><span class='detail-titikdua'> : </span><span class='detail-value'>" + result["driver_name"] + "</span></div>";
			content += "<div class='detail-row'><span class='detail-label'>Kendaraan</span><span class='detail-titikdua'> : </span><span class='detail-value'>" + result["vehicle_name"] + "</span></div>";
			content += "<div class='detail-row'><span class='detail-label'>Lacak</span><span class='detail-titikdua'> : </span><span class='detail-value'>" + result["device_name"] + "</span></div>";
			content += "</div>";
		}
		
		content += "<div class='detail-status'>";
		content += "<div class='detail-status-title'>Status</div>";
		content += "<div class='status-item'><span class='status-badge' data-status='0'>Pending</span><span class='status-time'>" + status_0 + "</span></div>";
		if (result["shipment_status"] >= 1) {
			content += '<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>';
			content += "<div class='status-item'><span class='status-badge' data-status='1'>Konfirmasi</span><span class='status-time'>" + status_1 + "</span></div>";
		}
		if (result["shipment_status"] >= 2) {
			content += '<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>';
			content += "<div class='status-item'><span class='status-badge' data-status='2'>" + status_2_name + "</span><span class='status-time'>" + status_2 + "</span></div>";
		}
		if (result["shipment_status"] >= 3) {
			content += '<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>';
			content += "<div class='status-item'><span class='status-badge' data-status='3'>" + status_3_name + "</span><span class='status-time'>" + status_3 + "</span></div>";
		}
		if (result["shipment_status"] >= 4) {
			content += '<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>';
			content += "<div class='status-item'><span class='status-badge' data-status='4'>" + status_4_name + "</span><span class='status-time'>" + status_4 + "</span></div>";
		}
		if (result["shipment_status"] >= 5) {
			content += '<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>';
			content += "<div class='status-item'><span class='status-badge' data-status='5'>" + status_5_name + "</span><span class='status-time'>" + status_5 + "</span></div>";
		}
		content += "</div>";
		
		$(element).next().find(".row-detail-td-content").html(content);
	});
}

function cancelShipment() {
	showFullscreenLoading();
	var shipment_id = $(".dialog-konfirmasi-cancel-transaction").data("shipment_id");
	ajaxCall("<?= base_url("kiriman-darat-ekspedisi/cancelShipment") ?>", {shipment_id: shipment_id}, function(result) {
		hideFullscreenLoading();
		if (result == "success") {
			closeDialog();
			refreshData();
		}
	});
}

function getKendaraan() {
	ajaxCall("<?= base_url("kiriman-darat-ekspedisi/getKendaraan") ?>", null, function(json) {
		var result = jQuery.parseJSON(json);
			
		var element = "";
		var iLength = result.length;
		for (var i = 0; i < iLength; i++) {
			kendaraan.push({
				id: result[i].vehicle_id,
				name: result[i].vehicle_name
			});
			element += "<option value='" + result[i].vehicle_id + "'>" + result[i].vehicle_name + "</option>";
		}
		$(".select-kendaraan").append(element);
	});
}

function getSupir() {
	ajaxCall("<?= base_url("kiriman-darat-ekspedisi/getSupir") ?>", null, function(json) {
		var result = jQuery.parseJSON(json);
			
		var element = "";
		var iLength = result.length;
		for (var i = 0; i < iLength; i++) {
			supir.push({
				id: result[i].driver_id,
				name: result[i].driver_name
			});
			element += "<option value='" + result[i].driver_id + "'>" + result[i].driver_name + "</option>";
		}
		$(".select-supir").append(element);
	});
}

function getAlat() {
	ajaxCall("<?= base_url("kiriman-darat-ekspedisi/getAlat") ?>", null, function(json) {
		var result = jQuery.parseJSON(json);
			
		var element = "";
		var iLength = result.length;
		for (var i = 0; i < iLength; i++) {
			alat.push({
				id: result[i].device_id,
				name: result[i].device_name
			});
			element += "<option value='" + result[i].device_id + "'>" + result[i].device_name + "</option>";
		}
		$(".select-alat").append(element);
	});
}

function submitTerima() {
	showFullscreenLoading();
	var shipment_id = $(".dialog-konfirmasi-terima-kiriman").data("id");
	var data = {
		shipment_id: shipment_id
	};
	ajaxCall("<?= base_url("kiriman-darat-ekspedisi/submitTerima") ?>", data, function(result) {
		closeDialog();
		hideFullscreenLoading();
		if (result == "success") {
			refreshData();
		} else {
			console.log(result);
		}
	});
}

function submitAmbil() {
	showFullscreenLoading();
	var shipment_id = $(".dialog-konfirmasi-ambil-kiriman").data("id");
	var data = {
		shipment_id: shipment_id
	};
	ajaxCall("<?= base_url("kiriman-darat-ekspedisi/submitAmbil") ?>", data, function(result) {
		closeDialog();
		hideFullscreenLoading();
		if (result == "success") {
			refreshData();
		} else {
			console.log(result);
		}
	});
}

function submitKirim() {
	showFullscreenLoading();
	var shipment_id = $(".dialog-konfirmasi-kirim-kiriman").data("id");
	var data = {
		shipment_id: shipment_id
	};
	ajaxCall("<?= base_url("kiriman-darat-ekspedisi/submitKirim") ?>", data, function(result) {
		closeDialog();
		hideFullscreenLoading();
		if (result == "success") {
			refreshData();
		} else {
			console.log(result);
		}
	});
}

function submitPesan() {
	var shipment_id = $(".dialog-konfirmasi-pesan-kiriman").data("id");
	var jenis_muatan =$(".dialog-konfirmasi-pesan-kiriman").data("jenis_muatan");
	var driver_id = $(".dialog-konfirmasi-pesan-kiriman").data("driver_id");
	var vehicle_id = $(".dialog-konfirmasi-pesan-kiriman").data("vehicle_id");
	var device_id =$(".dialog-konfirmasi-pesan-kiriman").data("device_id");
	
	if (driver_id == "" || driver_id == null) {
		alert("tidak ada supir yang dipilih");
	} else if (vehicle_id == "" || vehicle_id == null) {
		alert("tidak ada kendaraan yang dipilih");
	} else if (device_id == "" || device_id == null) {
		alert("tidak ada alat yang dipilih");
	} else {
		showFullscreenLoading();
		var data = {
			shipment_id: shipment_id,
			jenis_muatan: jenis_muatan,
			driver_id: driver_id,
			vehicle_id: vehicle_id,
			device_id: device_id
		};
		ajaxCall("<?= base_url("kiriman-darat-ekspedisi/submitPesan") ?>", data, function(result) {
			closeDialog();
			hideFullscreenLoading();
			if (result == "success") {
				refreshData();
			} else {
				console.log(result);
			}
		});
	}
}

function submitDeal() {
	showFullscreenLoading();
	var shipment_id = $(".dialog-konfirmasi-deal-kiriman").data("id");
	var data = {
		shipment_id: shipment_id
	};
	ajaxCall("<?= base_url("kiriman-darat-ekspedisi/submitDeal") ?>", data, function(result) {
		closeDialog();
		hideFullscreenLoading();
		if (result == "success") {
			refreshData();
		} else {
			console.log(result);
		}
	});
}

function refreshData() {
	var tabsNumber = $(".tabs-item.active").data("tabs-number");
	getKiriman(kirimanUrl[tabsNumber], tabsNumber, kirimanTabs[tabsNumber]);
	getKirimanCount();
}

function getKirimanCount() {
	ajaxCall("<?= base_url("kiriman-darat-ekspedisi/getKirimanSaya") ?>", null, function(json) {
		var result = jQuery.parseJSON(json);
		assignKirimanCount(result);
	});
}

function assignKirimanCount(result) {
	var tabs = {
		t1: 0,
		t2: 0,
		t3: 0,
		t4: 0,
		t5: 0,
		t6: 0,
		t7: 0,
		t8: 0
	};
	
	for (var i = 0; i < result.length; i++) {
		switch (result[i].shipment_status) {
			case "0":
				tabs.t1 = result[i].count;
				break;
			case "1":
				tabs.t2 = result[i].count;
				break;
			case "2":
				tabs.t3 = result[i].count;
				break;
			case "3":
				tabs.t4 = result[i].count;
				break;
			case "4":
				tabs.t5 = result[i].count;
				break;
			case "5":
				tabs.t6 = result[i].count;
				break;
			case "6":
				tabs.t7 = result[i].count;
				break;
			case "7":
				tabs.t8 = result[i].count;
				break;
		}
	}
	
	for (var i = 1; i <= 8; i++) {
		updateTabsItemCount(i, tabs["t" + i]);
	}
}

function getKiriman(url, tabsNumber, tabs) {
	abortAjaxCall();
	$(".tabs-content[data-tabs-number='" + tabsNumber + "'] .tbody-kiriman").html("");
	setLoading(".tabs-content[data-tabs-number='" + tabsNumber + "'] .table-empty-state");
	ajaxCall(url, null, function(json) {
		removeLoading();
		var result = jQuery.parseJSON(json);
		addKirimanToTable(result, tabsNumber, tabs);
	});
}

function addKirimanToTable(result, tabsNumber, tab) {
	var iLength = result.length;
	var element = {
		"deal": {
			value: "",
			btn: "<td><button class='btn-default btn-deal'>Konfirmasi</button><button class='btn-negative btn-batal-pengiriman'>Tolak</button></td>"
		},
		"pending": {
			value: "",
			btn: "<td><button class='btn-default btn-pesan'>Pesan</button><button class='btn-negative btn-batal-pengiriman'>Batalkan</button></td>"
		},
		"pesanan": {
			value: "",
			btn: "<td><button class='btn-default btn-dikirim'>Dikirim</button><button class='btn-negative btn-batal-pengiriman'>Batalkan</button></td>"
		},
		"dikirim": {
			value: "",
			btn: "<td><button class='btn-default btn-diambil'>Diambil</button><button class='btn-negative btn-batal-pengiriman'>Batalkan</button></td>"
		},
		"diambil": {
			value: "",
			btn: "<td><button class='btn-default btn-diterima'>Diterima</button></td>"
		},
		"diterima": {
			value: "",
			btn: "",
		},
		"selesai": {
			value: "",
			btn: ""
		},
		"cancel": {
			value: "",
			btn: ""
		}
	};
	
	for (var i = 0; i < iLength; i++) {
		
		var date_from = new Date(result[i].shipment_delivery_date_from);
		var fullDateFrom = date_from.getDate() + " " + month[date_from.getMonth()] + " " + date_from.getFullYear().toString().substring(2);
		var date_to = new Date(result[i].shipment_delivery_date_to);
		var fullDateTo = date_to.getDate() + " " + month[date_to.getMonth()] + " " + date_to.getFullYear().toString().substring(2);
		
		var shipment_picture = (result[i].shipment_pictures == "") ? "default.gif" : result[i].shipment_pictures;
		var jenis_muatan = "Penuh";
		if (result[i].shipment_jenis_muatan == 0) {
			jenis_muatan = "Parsial";
		}
		
		var btnViewKontak = "<button class='btn-default btn-view-kontak'>Info Kiriman</button>";
		var tdJenisMuatan = "<td class='td-jenis-muatan'>" + jenis_muatan + "</td>";
		var additionalTd = "";
		var tdCancelBy = "";
		var waktu = "";
		switch (tab) {
			case "deal":
				btnViewKontak = "";
				tdJenisMuatan = "";
				break;
			case "pending":
				tdJenisMuatan = "<td><select class='select-jenis-muatan'><option value='1'>Penuh</option><option value='0'>Parsial</option></select></td>";
				additionalTd = "<td><select class='select-supir'></select></td><td><select class='select-kendaraan'></select></td><td><select class='select-alat'></select></td>";
				break;
			case "pesanan":
				additionalTd = "<td class='td-supir'>" + result[i].driver_names + "</td><td class='td-kendaraan'>" + result[i].vehicle_names + "</td><td class='td-alat'>" + result[i].device_names + "</td>";
				break;
			case "dikirim":
				additionalTd = "<td class='td-supir'>" + result[i].driver_names + "</td><td class='td-kendaraan'>" + result[i].vehicle_names + "</td><td class='td-alat'>" + result[i].device_names + "</td>";
				break;
			case "diambil":
				additionalTd = "<td class='td-supir'>" + result[i].driver_names + "</td><td class='td-kendaraan'>" + result[i].vehicle_names + "</td><td class='td-alat'>" + result[i].device_names + "</td>";
				break;
			case "diterima":
				additionalTd = "<td class='td-supir'>" + result[i].driver_names + "</td><td class='td-kendaraan'>" + result[i].vehicle_names + "</td><td class='td-alat'>" + result[i].device_names + "</td>";
				break;
			case "selesai":
				additionalTd = "<td class='td-supir'>" + result[i].driver_names + "</td><td class='td-kendaraan'>" + result[i].vehicle_names + "</td><td class='td-alat'>" + result[i].device_names + "</td>";
				waktu = "<td data-align='center'>" + result[i].waktu_kiriman + " hari</td><td data-align='center'>" + result[i].total_waktu + " hari</td>";
				break;
			case "cancel":
				btnViewKontak = "";
				tdJenisMuatan = "";
				var icon = (result[i].user_verified == 0) ? "" : "<span class='verified-icon' style='background-image: url(" + verifiedIconUrl + ");'><div></div></span>";
				tdCancelBy = "<td class='td-cancel_by'><a href='" + profilUrl + result[i].cancel_by + "'>" + result[i].cancel_username + icon + "</a></td>";
				break;
		}
		
		element[tab].value += "<tr class='tr-kiriman' data-id='" + result[i].shipment_id + "' data-shipment-title='" + result[i].shipment_title + "' data-asal='" + result[i].location_from_city + "' data-tujuan='" + result[i].location_to_city + "'><td class='td-title' data-col='nama-kirim'><a href='<?= base_url("kirim/detail/") ?>" + result[i].shipment_id + "'>" + "<img class='shipment-picture' src='<?= base_url("assets/panel/images/") ?>" + shipment_picture + "' onerror='this.onerror=null; this.src=\"<?php echo base_url("assets/panel/images/default.gif"); ?>\";' /><span>" + result[i].shipment_title + "</span></a></td><td class='td-price' data-col='harga'>Bid : " + result[i].bidding_count + "<br>Low : " + addCommas(result[i].low) + " IDR" + btnViewKontak + "</td><td class='td-asal' data-col='asal'>" + result[i].location_from_city + "<br>" + fullDateFrom + " - " + fullDateTo + "</td><td class='td-tujuan' data-col='tujuan'>" + result[i].location_to_city + "<br>" + fullDateFrom + " - " + fullDateTo + "</td><td class='td-km' data-align='center' data-col='km'>" + parseInt(result[i].shipment_length) + "</td>" + tdJenisMuatan + tdCancelBy + additionalTd + element[tab].btn + waktu + "</tr>";

		element[tab].value += "<tr class='row-detail-tr'><td class='row-detail-td' colspan='20'><div class='row-detail-td-content'></div></td></tr>";
	}
	
	if (iLength == 0) {
		$(".tabs-content[data-tabs-number='" + tabsNumber + "'] .table-empty-state").addClass("shown");
	} else {
		$(".tabs-content[data-tabs-number='" + tabsNumber + "'] .table-empty-state").removeClass("shown");
	}
	$(".tabs-content[data-tabs-number='" + tabsNumber + "'] .tbody-kiriman").html("");
	$(".tabs-content[data-tabs-number='" + tabsNumber + "'] .tbody-kiriman").append(element[tab].value);
	
	if (tab == "pending" && iLength > 0) {
		getAlat();
		getSupir();
		getKendaraan();
	}
}
</script>