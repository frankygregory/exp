function getAllStatusKiriman(a,t){var s=$(a).data("id");ajaxCall(getAllStatusKirimanUrl,{shipment_id:s},function(a){var s=JSON.parse(a);if("success"==s.status){var i,n,e,l,d,r,c,o,p,m=s.pending_date,g=s.confirmation_date;1==s.bidding_type?(i=s.order_date,n="Pesanan",e=s.delivery_date,l="Dikirim",d=s.pickup_date,r="Diambil",c=s.receive_date,o="Diterima",p=s.end_date):(i=s.door_start_date,n="Door 1",e=s.port_start_date,l="Port 1",d=s.port_finish_date,r="Port 2",c=s.door_finish_date,o="Door 2",p=s.ending_date);var u="";u+="<div class='detail-status'>",u+="<div class='detail-status-title'>Status</div>",u+="<div class='status-item'><span class='status-badge' data-status='0'>Pending</span><span class='status-time'>"+m+"</span></div>",u+='<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>',u+="<div class='status-item'><span class='status-badge' data-status='1'>Konfirmasi</span><span class='status-time'>"+g+"</span></div>",u+='<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>',u+="<div class='status-item'><span class='status-badge' data-status='2'>"+n+"</span><span class='status-time'>"+i+"</span></div>",u+='<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>',u+="<div class='status-item'><span class='status-badge' data-status='3'>"+l+"</span><span class='status-time'>"+e+"</span></div>",u+='<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>',u+="<div class='status-item'><span class='status-badge' data-status='4'>"+r+"</span><span class='status-time'>"+d+"</span></div>",u+='<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>',u+="<div class='status-item'><span class='status-badge' data-status='5'>"+o+"</span><span class='status-time'>"+c+"</span></div>",u+='<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>',u+="<div class='status-item'><span class='status-badge' data-status='6'>Selesai</span><span class='status-time'>"+p+"</span></div>",u+="</div>",$(t).find(".row-detail-td-content").html(u)}})}function getDetailPengirim(a){var t=$(a).data("id");ajaxCall(getDetailPengirimUrl,{shipment_id:t},function(t){var s=jQuery.parseJSON(t),i="";i+="<div class='detail-col'>",i+="<div class='detail-title'>Info Ekspedisi</div>",i+="<div class='detail-row'><span class='detail-label'>Nama</span><span class='detail-titikdua'> : </span><span class='detail-value'>"+s.user_fullname+"</span></div>",i+="<div class='detail-row'><span class='detail-label'>Alamat</span><span class='detail-titikdua'> : </span><span class='detail-value'>"+s.user_address+"</span></div>",i+="<div class='detail-row'><span class='detail-label'>Telepon</span><span class='detail-titikdua'> : </span><span class='detail-value'>"+s.user_telephone+"</span></div>",i+="<div class='detail-row'><span class='detail-label'>Handphone</span><span class='detail-titikdua'> : </span><span class='detail-value'>"+s.user_handphone+"</span></div>",i+="</div>";var n,e,l,d,r,c,o,p,m=s.pending_date,g=s.confirmation_date;"1"==s.bidding_type?(n=s.order_date,e="Pesanan",l=s.delivery_date,d="Dikirim",r=s.pickup_date,c="Diambil",o=s.receive_date,p="Diterima",s.shipment_status>1&&(i+="<div class='detail-col'>",i+="<div class='detail-title'>Detail Supir</div>",i+="<div class='detail-row'><span class='detail-label'>Nama</span><span class='detail-titikdua'> : </span><span class='detail-value'>"+s.driver_name+"</span></div>",i+="<div class='detail-row'><span class='detail-label'>Handphone</span><span class='detail-titikdua'> : </span><span class='detail-value'>"+s.driver_handphone+"</span></div>",i+="<div class='detail-row'><span class='detail-label'>Kendaraan</span><span class='detail-titikdua'> : </span><span class='detail-value'>"+s.vehicle_name+" ("+s.vehicle_nomor+")</span></div>",i+="</div>")):(n=s.door_start_date,e="Door 1",l=s.port_start_date,d="Port 1",r=s.port_finish_date,c="Port 2",o=s.door_finish_date,p="Door 2",s.shipment_status>1&&(i+="<div class='detail-col'>",i+="<div class='detail-title'>Detail Kiriman</div>",i+="<div class='detail-row'><span class='detail-label'>No. Kontainer</span><span class='detail-titikdua'> : </span><span class='detail-value'>"+s.shipment_details_container_number+"</span></div>",i+="</div>")),i+="<div class='detail-status'>",i+="<div class='detail-status-title'>Status</div>",i+="<div class='status-item'><span class='status-badge' data-status='0'>Pending</span><span class='status-time'>"+m+"</span></div>",s.shipment_status>=1&&(i+='<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>',i+="<div class='status-item'><span class='status-badge' data-status='1'>Konfirmasi</span><span class='status-time'>"+g+"</span></div>"),s.shipment_status>=2&&(i+='<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>',i+="<div class='status-item'><span class='status-badge' data-status='2'>"+e+"</span><span class='status-time'>"+n+"</span></div>"),s.shipment_status>=3&&(i+='<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>',i+="<div class='status-item'><span class='status-badge' data-status='3'>"+d+"</span><span class='status-time'>"+l+"</span></div>"),s.shipment_status>=4&&(i+='<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>',i+="<div class='status-item'><span class='status-badge' data-status='4'>"+c+"</span><span class='status-time'>"+r+"</span></div>"),s.shipment_status>=5&&(i+='<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>',i+="<div class='status-item'><span class='status-badge' data-status='5'>"+p+"</span><span class='status-time'>"+o+"</span></div>"),i+="</div>",$(a).next().find(".row-detail-td-content").html(i)})}function cancelShipment(){showFullscreenLoading();var a={shipment_id:$(".dialog-konfirmasi-cancel-transaction").data("id")};ajaxCall(cancelShipmentUrl,a,function(a){"success"==a?(hideFullscreenLoading(),closeDialog(),refreshData()):alert(a)})}function submitRating(a){showFullscreenLoading();var t=getRatingValue(),s=$(a).parent().find("textarea.input-rating-feedback").val(),i={shipment_id:$(a).closest(".tr-kiriman").data("id"),shipment_rating_number:t,shipment_rating_feedback:s};ajaxCall(submitRatingUrl,i,function(a){hideFullscreenLoading(),"success"==a?refreshData():alert(a)})}function refreshData(){var a=$(".tabs-item.active").data("tabs-number");getKiriman(kirimanUrl[a],a,kirimanTabs[a]),getKirimanCount()}function getKirimanCount(){ajaxCall(getKirimanCountUrl,null,function(a){assignKirimanCount(jQuery.parseJSON(a))})}function assignKirimanCount(a){var t={t1:0,t2:0,t3:0,t4:0};t.t1=a.open_kiriman_count,t.t2=a.progress_kiriman_count,t.t3=a.selesai_kiriman_count,t.t4=a.cancel_kiriman_count;for(var s=1;s<=4;s++)updateTabsItemCount(s,t["t"+s])}function getKiriman(a,t,s){abortAjaxCall(),$(".tabs-content[data-tabs-number='"+t+"'] .tbody-kiriman").html(""),setLoading(".tabs-content[data-tabs-number='"+t+"'] .table-empty-state"),ajaxCall(a,null,function(a){removeLoading(),addKirimanToTable(jQuery.parseJSON(a),t,s)})}function addKirimanToTable(a,t,s){for(var i=a.length,n={open:"",progress:"",selesai:"",cancel:""},e=0;e<i;e++){var l=new Date(a[e].shipment_delivery_date_from),d=l.getDate()+" "+month[l.getMonth()]+" "+l.getFullYear().toString().substring(2),r=new Date(a[e].shipment_delivery_date_to),c=r.getDate()+" "+month[r.getMonth()]+" "+r.getFullYear().toString().substring(2);0==a[e].shipment_jenis_muatan?"Parsial":-1==a[e].shipment_jenis_muatan&&"";var o=""==a[e].shipment_pictures?"default.gif":a[e].shipment_pictures,p=a[e].bidding_type,m=a[e].shipment_status,g="",u="<td data-col='action'><button class='btn-negative btn-cancel-transaction'>Batalkan Kiriman</button></td>",v="",h="",w="<button class='btn-default btn-view-kontak'>Info Kiriman</button>",b="Low : ";switch(s){case"open":v="<td data-col='berakhir'>"+a[e].berakhir+"</td>",w="";break;case"progress":b="",0==m&&(w=""),5==m?u="<td data-col='action'><div class='rating-section'>"+getRatingJs()+"<textarea class='input-rating-feedback'></textarea><button class='btn-default btn-submit-rating'>Submit</button></div></td>":m>=3?u="<td data-col='action'></td>":2==m&&"laut"==p&&(u="<td data-col='action'></td>"),g="<td data-col='status' data-align='center'>"+statusDetail[m][p]+"</td>";break;case"selesai":b="",u="",g="<td data-col='status' data-align='center'>"+statusDetail[m]+"</td>";break;case"cancel":w="";var _=0==a[e].user_verified?"":"<span class='verified-icon' style='background-image: url("+verifiedIconUrl+");'><div></div></span>";h+="<td data-col='cancel-by'><a href='"+profilUrl+a[e].cancel_by+"'>"+a[e].cancel_username+_+"</a></td>",u=""}n[s]+="<tr class='tr-kiriman' data-id='"+a[e].shipment_id+"'><td class='td-title' data-col='nama-kirim'><a href='"+shipmentUrl+a[e].shipment_id+"'><img class='shipment-picture' src='"+shipmentPictureUrl+o+"' onerror='this.onerror=null; this.src=\""+defaultPictureUrl+"\";' /><span>"+a[e].shipment_title+"</span></a></td><td class='td-price' data-col='harga'>Bid : "+a[e].bidding_count+"<br>"+b+addCommas(a[e].low)+" IDR"+w+"</td><td class='td-asal' data-col='asal'>"+a[e].location_from_city+"<br>"+d+" - "+c+"</td><td class='td-tujuan' data-col='tujuan'>"+a[e].location_to_city+"<br>"+d+" - "+c+"</td><td class='td-km' data-col='km' data-align='center'>"+parseInt(a[e].shipment_length)+"</td>"+g+v+u+h+"</tr>",n[s]+="<tr class='row-detail-tr'><td class='row-detail-td' colspan='20'><div class='row-detail-td-content'></div></td></tr>"}0==i?$(".tabs-content[data-tabs-number='"+t+"'] .table-empty-state").addClass("shown"):$(".tabs-content[data-tabs-number='"+t+"'] .table-empty-state").removeClass("shown"),$(".tabs-content[data-tabs-number='"+t+"'] .tbody-kiriman").html(n[s])}$(function(){function a(){$(".container-content").scrollTop()>=n&&($(".table-kiriman").addClass("fixed"),$(".container-content").off("scroll"),$(".container-content").on("scroll",t))}function t(){$(".container-content").scrollTop()<=n&&($(".table-kiriman").removeClass("fixed"),$(".container-content").off("scroll"),$(".container-content").on("scroll",a))}getKiriman(kirimanUrl[1],1,"open"),getKirimanCount(),$(".tabs-item").on("click",function(){abortAjaxCall();var a=$(this).data("tabs-number");getKiriman(kirimanUrl[a],a,kirimanTabs[a])});var s=parseInt($(".navigation-header").css("height")),i=parseInt($(".table-kiriman thead").css("height")),n=$(".table-kiriman tbody").offset().top-s-i;$(".container-content").on("scroll",a),$(document).on("click",".btn-submit-rating",function(){submitRating(this)}),$(document).on("click",".btn-cancel-transaction",function(){var a=$(this).closest(".tr-kiriman").data("id"),t=$(this).closest(".tr-kiriman").find(".td-title span").html();$(".dialog-konfirmasi-cancel-transaction .dialog-body").html("Batalkan pengiriman untuk<br><strong>"+t+"</strong>"),$(".dialog-konfirmasi-cancel-transaction").data("id",a),showDialog(".dialog-konfirmasi-cancel-transaction")}),$(".btn-submit-cancel-transaction").on("click",function(){cancelShipment()}),$(document).on("click",".tabs-content[data-tabs-number='2'] .btn-view-kontak",function(){var a=$(this).closest(".tr-kiriman"),t=$(a).next();0==$(t).height()?($(t).addClass("show"),""==$(t).find(".row-detail-td-content").html().trim()&&getDetailPengirim(a)):$(t).removeClass("show")}),$(document).on("click",".tabs-content[data-tabs-number='3'] .btn-view-kontak",function(){var a=$(this).closest(".tr-kiriman"),t=$(a).next();0==t.height()?(t.addClass("show"),""==t.find(".row-detail-td-content").html().trim()&&getAllStatusKiriman(a,t)):t.removeClass("show")}),$(document).on("click","table td a",function(a){a.stopPropagation()})});