function cancelBidding(){setLoading(".default-loading-container-cancel-bidding");var a=$(".dialog-konfirmasi-cancel-bidding").data("id");ajaxCall(cancelBiddingUrl,{bidding_id:a},function(a){"success"==a?location.reload():(removeLoading(".default-loading-container-cancel-bidding"),alert(a))})}function kirimPertanyaan(){var a=$(".input-pertanyaan").val(),n=data_shipment_id;if(""!=a){$(".detail-pertanyaan").css("display","none"),$(".discussions").html(""),setLoading(".section-3-content .default-empty-state");var i={submit_pertanyaan:!0,questions_text:a,shipment_id:n};ajaxCall(kirimPertanyaanUrl,i,function(a){$(".detail-pertanyaan").css("display","block"),"success"==a&&(clearQuestion(),getDiscussions(!1))})}else alert("Pertanyaan tidak boleh kosong"),$(".input-pertanyaan").select()}function clearQuestion(){$(".input-pertanyaan").val("")}function getKendaraan(){ajaxCall(getKendaraanUrl,null,function(a){addKendaraanToOption(jQuery.parseJSON(a))})}function addKendaraanToOption(a){for(var n="",i=a.length,t=0;t<i;t++)n+="<option value='"+a[t].vehicle_id+"'>"+a[t].vehicle_name+"</option>";$(".input-kendaraan").html(""),$(".input-kendaraan").append(n)}function showDetailPenawaran(a){$(a).css("display","none"),$(".detail-penawaran").css("display","block"),$(".input-bidding-price").select()}function hideDetailPenawaran(){$(".btn-tawar").css("display","block"),$(".detail-penawaran").css("display","none"),clearErrors()}function kirimPenawaran(){var a={bidding_type:$(".input-bidding-type:checked").val(),bidding_type_name:$(".input-bidding-type:checked").data("value"),bidding_price:$(".input-bidding-price").val(),bidding_pickupdate:$(".input-bidding-pickupdate").val(),bidding_vehicle:$(".input-kendaraan").val(),bidding_information:$(".input-bidding-information").val()};cekInputPenawaran(a)&&getGroupIds(a)}function submitKirimPenawaran(){showFullscreenLoading();var a=data_shipment_id,n=current_user_id,i={submit_bid:!0,bidding_type:$(".input-bidding-type:checked").val(),bidding_price:$(".input-bidding-price").val().replace(/,/g,""),bidding_pickupdate:$(".input-bidding-pickupdate").val(),bidding_vehicle:$(".input-kendaraan").val(),bidding_information:$(".input-bidding-information").val(),shipment_id:a,user_id:n,group_id:$(".select-group").val()};ajaxCall(kirimPenawaranUrl,i,function(a){closeDialog(),hideFullscreenLoading(),"success"==a&&($(".btn-tawar").prop("disabled",!0),hideDetailPenawaran(),getBiddingList())})}function cekInputPenawaran(a){clearErrors();var n=!0;return""==a.bidding_price&&(n=!1,$(".error-bidding-price").html("Harga harus diisi")),""==a.bidding_pickupdate&&(n=!1,$(".error-bidding-pickupdate").html("Tanggal Ambil harus diisi")),""==a.bidding_vehicle&&(n=!1,$(".error-kendaraan").html("Kendaraan harus diisi")),n}function getGroupIds(a){showFullscreenLoading(),ajaxCall(getGroupIdsUrl,null,function(n){hideFullscreenLoading();var i=jQuery.parseJSON(n),t=$(".dialog-konfirmasi-penawaran");t.find(".dialog-value[data-label='jenis-penawaran']").html(a.bidding_type_name);var e=a.bidding_price;""!=e&&(e+=" IDR"),t.find(".dialog-value[data-label='harga']").html(e),t.find(".dialog-value[data-label='tanggal-ambil']").html(a.bidding_pickupdate),"Darat"==a.bidding_type_name?t.find(".dialog-label[data-label='kendaraan']").html("Kendaraan"):t.find(".dialog-label[data-label='kendaraan']").html("Kapal"),t.find(".dialog-value[data-label='kendaraan']").html(a.bidding_vehicle),t.find(".dialog-value[data-label='keterangan']").html(a.bidding_information),$(".btn-submit-penawaran").prop("disabled",!0);for(var d="<option value='0'>Pilih Group...</option>",s=0;s<i.length;s++){var l=""!=i[s].group_name?i[s].group_name:"default";d+="<option value='"+i[s].group_id+"'>"+l+"</option>"}t.find(".select-group").html(d),showDialog(".dialog-konfirmasi-penawaran")})}function clearErrors(){$(".error").html("")}function setujuBidding(a){setLoading(".default-loading-container-setuju-penawaran");var n=$(a).closest(".dialog-konfirmasi-setuju").data("bidding_id"),i="<input type='hidden' name='shipment_id' value='"+data_shipment_id+"' />",t="<input type='hidden' name='bidding_id' value='"+n+"' />";$("<form>",{action:setujuBiddingUrl,method:"POST",html:i+t}).appendTo(document.body).submit()}function jawabPertanyaan(a){var n=$(a).closest(".discussions-item"),i=$(n).children(".questions").data("questions-id"),t=$(n).find("textarea").val();if(""!=t){$(".discussions").html(""),setLoading(".section-3-content .default-empty-state");var e={submit_jawaban:!0,questions_id:i,answers_text:t};ajaxCall(jawabPertanyaanUrl,e,function(a){"success"==a&&getDiscussions(!1)})}else alert("Jawaban tidak boleh kosong"),$(n).find("textarea").select()}function showDetailJawabPertanyaan(a){$(".detail-jawab-pertanyaan").css("display","none");var n=$(a).closest(".discussions-item").children(".detail-jawab-pertanyaan");$(n).css("display","block"),$(n).children("textarea").select()}function closeDetailJawabPertanyaan(){$(".detail-jawab-pertanyaan").css("display","none")}function submitTolak(a){$(".tbody-list-penawaran").html(""),setLoading(".table-list-penawaran-container .table-empty-state");var n={submit_tolak:!0,bidding_id:$(a).data("bidding_id"),bidding_reason:$(a).siblings(".input-alasan").val()};ajaxCall(submitTolakUrl,n,function(a){removeLoading(".table-list-penawaran-container .table-empty-state"),"success"==a&&getBiddingList(!1)})}function showAlasanTolak(a){$(a).next().css("display","block"),$(a).next().children(".input-alasan").select()}function hideAlasanTolak(a){$(a).parent().css("display","none")}function getDiscussions(a){void 0===a&&(a=!1),a&&($(".discussions").html(""),setLoading(".section-3-content .default-empty-state"));var n={shipment_id:data_shipment_id};ajaxCall(getDiscussionsUrl,n,function(a){removeLoading(".section-3-content .default-empty-state"),addDiscussionToTable(jQuery.parseJSON(a))})}function addDiscussionToTable(a){for(var n=a.questions,i=n.length,t="",e=0;e<i;e++){var d=0==n[e].user_verified?"":"<span class='verified-icon' style='background-image: url("+verifiedIconUrl+");'><div></div></span>";t+="<div class='discussions-item'>",t+="<div class='questions' data-questions-id='"+n[e].questions_id+"'>",t+="<div class='questions-user-id'><a href='"+profilUrl+n[e].user_id+"'>"+n[e].username+"</a>"+d+"</div>",t+="<div class='questions-text'>"+n[e].questions_text+"</div>",btnJawabPertanyaan&&(t+="<button class='btn-neutral btn-jawab-pertanyaan'>Jawab</button>"),t+="<div class='discussion-item-time'>"+n[e].created_date+"</div>",t+="</div>";for(var s=a.answers[e],l=s.length,o=0;o<l;o++)t+="<div class='answers'>",t+="<div class='answers-user-id'><a href='"+profilUrl+shipment_user_id+"'>"+shipment_owner_username+"</a>"+verified_icon+"</div>",t+="<div class='answers-text'>"+s[o].answers_text+"</div>",t+="<div class='discussion-item-time'>"+s[o].created_date+"</div>",t+="</div>";btnJawabPertanyaan&&(t+="<div class='detail-jawab-pertanyaan'>",t+="<textarea class='input-jawab-pertanyaan'></textarea>",t+="<button class='btn-default btn-submit-jawab-pertanyaan'>Submit Jawaban</button>",t+="</div>",t+="</div>")}0==i?$(".section-3-content .default-empty-state").addClass("shown"):$(".section-3-content .default-empty-state").removeClass("shown"),$(".discussions").html(t)}function getBiddingList(a){void 0===a&&(a=!1),a&&($(".tbody-list-penawaran").html(""),setLoading(".table-list-penawaran-container .table-empty-state"));var n={shipment_id:data_shipment_id};ajaxCall(getBiddingListUrl,n,function(a){removeLoading(".table-list-penawaran-container .table-empty-state"),addBiddingListToTable(jQuery.parseJSON(a))})}function addBiddingListToTable(a){for(var n=a.data.length,i="",t=0;t<n;t++){var e="Darat";2==a.data[t].bidding_type&&(e="Laut");var d=0==a.data[t].user_verified?"":"<span class='verified-icon' style='background-image: url("+verifiedIconUrl+");'></span>";i+="<tr class='tr-bidding' data-status='"+a.data[t].bidding_status+"' data-bidding_id='"+a.data[t].bidding_id+"'>",i+="<td class='td-bidding-price' data-value='"+a.data[t].bidding_price+"'>"+addCommas(a.data[t].bidding_price)+" IDR</td>",i+="<td class='td-bidding-type' data-value='"+e+"'>"+e+"</td>",i+="<td class='td-bidding-username'><a href='"+profilUrl+a.data[t].user_id+"'>"+a.data[t].username+"</a>"+d+"</td>",i+="<td class='td-bidding-tanggal-ambil'>",i+="<div>Tanggal Ambil : "+a.data[t].bidding_pickupdate+"</div>",i+="<div>Keterangan : "+a.data[t].bidding_information+"</div>",null!==a.data[t].bidding_vehicle&&(i+="<div>Kendaraan : "+a.data[t].bidding_vehicle+"</div>"),i+="</td>",i+="<td>",1==a.data[t].bidding_status?i+="DITERIMA <span class='bidding-tanggal-batal'>"+a.data[t].modified_date+"</span>":2==a.data[t].bidding_status?i+="<div class='alasan-tolak'>DITOLAK <span class='bidding-tanggal-batal'>"+a.data[t].modified_date+"</span><br><strong>Alasan : </strong>"+a.data[t].bidding_reason+"</div>":-1==a.data[t].bidding_status?i+="DIBATALKAN <span class='bidding-tanggal-batal'>"+a.data[t].modified_date+"</span>":btnJawabPertanyaan?(i+="<button class='btn-default btn-setuju'>Setuju</button>",i+="<button class='btn-negative btn-tolak'>Tolak</button>",i+="<div class='container-tolak'>",i+="<textarea class='input-alasan' data-bidding_id='"+a.data[t].bidding_id+"'></textarea>",i+="<button class='btn-negative btn-submit-tolak' data-bidding_id='"+a.data[t].bidding_id+"'>Tolak</button>",i+="<button class='btn-neutral btn-batal-tolak'>Batal Tolak</button>",i+="</div>"):btnCancelBidding&&user_id==a.data[t].created_by&&(i+="<button class='btn-negative btn-cancel-bidding'>Batalkan</button>"),i+="</td>",i+="<td>"+a.data[t].created_date+"</td>",i+="</tr>"}0==n?$(".table-list-penawaran-container .table-empty-state").addClass("shown"):$(".table-list-penawaran-container .table-empty-state").removeClass("shown"),$(".tbody-list-penawaran").html(i),a.canBid&&$(".btn-tawar").prop("disabled",!1)}function initMap(){lat=location_from_lat,lng=location_from_lng,center_from={lat:lat,lng:lng},map=new google.maps.Map(document.getElementById("map_asal"),{scrollwheel:!1,disableDoubleClickZoom:!0,draggable:!1,panControl:!1,clickableIcons:!1,streetViewControl:!1,disableDefaultUI:!0}),marker_from=new google.maps.Marker({position:new google.maps.LatLng(location_from_lat,location_from_lng),map:map,icon:"https://maps.google.com/mapfiles/marker_greenA.png"}),marker_to=new google.maps.Marker({position:new google.maps.LatLng(location_to_lat,location_to_lng),map:map,label:"B"});var a=new google.maps.DirectionsService,n=new google.maps.DirectionsRenderer;n.setMap(map),n.setOptions({suppressMarkers:!0}),calculateAndDisplayRoute(a,n)}function calculateAndDisplayRoute(a,n){a.route({origin:new google.maps.LatLng(location_from_lat,location_from_lng),destination:new google.maps.LatLng(location_to_lat,location_to_lng),travelMode:"DRIVING"},function(a,i){if("OK"===i)n.setDirections(a);else if("ZERO_RESULTS"==i){var t=new google.maps.LatLngBounds;new google.maps.InfoWindow;t.extend(marker_from.position),t.extend(marker_to.position),map.fitBounds(t)}})}