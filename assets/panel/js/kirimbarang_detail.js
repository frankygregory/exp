function cancelBidding(){setLoading(".default-loading-container-cancel-bidding");var a=$(".dialog-konfirmasi-cancel-bidding").data("id");ajaxCall(cancelBiddingUrl,{bidding_id:a},function(a){"success"==a?location.reload():(removeLoading(".default-loading-container-cancel-bidding"),alert(a))})}function kirimPertanyaan(){var a=$(".input-pertanyaan").val(),n=data_shipment_id;if(""!=a){$(".detail-pertanyaan").css("display","none"),$(".discussions").html(""),setLoading(".section-3-content .default-empty-state");var t={submit_pertanyaan:!0,questions_text:a,shipment_id:n};ajaxCall(kirimPertanyaanUrl,t,function(a){$(".detail-pertanyaan").css("display","block"),"success"==a&&(clearQuestion(),getDiscussions(!1))})}else alert("Pertanyaan tidak boleh kosong"),$(".input-pertanyaan").select()}function clearQuestion(){$(".input-pertanyaan").val("")}function getKendaraan(){ajaxCall(getKendaraanUrl,null,function(a){addKendaraanToOption(jQuery.parseJSON(a))})}function addKendaraanToOption(a){for(var n="",t=a.length,i=0;i<t;i++)n+="<option value='"+a[i].vehicle_id+"'>"+a[i].vehicle_name+"</option>";$(".input-kendaraan").html(""),$(".input-kendaraan").append(n)}function showDetailPenawaran(a){$(a).css("display","none"),$(".detail-penawaran").css("display","block"),$(".input-bidding-price").select()}function hideDetailPenawaran(){$(".btn-tawar").css("display","block"),$(".detail-penawaran").css("display","none"),clearErrors()}function kirimPenawaran(){var a=$(".input-bidding-type:checked").val(),n=$(".input-bidding-price").val().replace(/,/g,""),t=$(".input-bidding-pickupdate").val(),i=$(".input-kendaraan").val(),e=$(".input-bidding-information").val(),d={bidding_type:a,bidding_price:n,bidding_pickupdate:t,bidding_vehicle:i,bidding_information:e};cekInputPenawaran(d)&&(setLoading(".default-loading-container-kirim-penawaran"),d={submit_bid:!0,bidding_type:a,bidding_price:n,bidding_pickupdate:t,bidding_vehicle:i,bidding_information:e,shipment_id:data_shipment_id,user_id:current_user_id},ajaxCall(kirimPenawaranUrl,d,function(a){removeLoading(".default-loading-container-kirim-penawaran"),"success"==a&&($(".btn-tawar").prop("disabled",!0),hideDetailPenawaran(),getBiddingList())}))}function cekInputPenawaran(a){clearErrors();var n=!0;return""==a.bidding_price&&(n=!1,$(".error-bidding-price").html("Harga harus diisi")),""==a.bidding_pickupdate&&(n=!1,$(".error-bidding-pickupdate").html("Tanggal Ambil harus diisi")),""==a.bidding_vehicle&&(n=!1,$(".error-kendaraan").html("Kendaraan harus diisi")),n}function clearErrors(){$(".error").html("")}function setujuBidding(a){setLoading(".default-loading-container-setuju-penawaran");var n=$(a).closest(".dialog-konfirmasi-setuju").data("bidding_id"),t="<input type='hidden' name='shipment_id' value='"+data_shipment_id+"' />",i="<input type='hidden' name='bidding_id' value='"+n+"' />";$("<form>",{action:setujuBiddingUrl,method:"POST",html:t+i}).appendTo(document.body).submit()}function jawabPertanyaan(a){var n=$(a).closest(".discussions-item"),t=$(n).children(".questions").data("questions-id"),i=$(n).find("textarea").val();if(""!=i){$(".discussions").html(""),setLoading(".section-3-content .default-empty-state");var e={submit_jawaban:!0,questions_id:t,answers_text:i};ajaxCall(jawabPertanyaanUrl,e,function(a){"success"==a&&getDiscussions(!1)})}else alert("Jawaban tidak boleh kosong"),$(n).find("textarea").select()}function showDetailJawabPertanyaan(a){$(".detail-jawab-pertanyaan").css("display","none");var n=$(a).closest(".discussions-item").children(".detail-jawab-pertanyaan");$(n).css("display","block"),$(n).children("textarea").select()}function closeDetailJawabPertanyaan(){$(".detail-jawab-pertanyaan").css("display","none")}function submitTolak(a){$(".tbody-list-penawaran").html(""),setLoading(".table-list-penawaran-container .table-empty-state");var n={submit_tolak:!0,bidding_id:$(a).data("bidding_id"),bidding_reason:$(a).siblings(".input-alasan").val()};ajaxCall(submitTolakUrl,n,function(a){removeLoading(".table-list-penawaran-container .table-empty-state"),"success"==a&&getBiddingList(!1)})}function showAlasanTolak(a){$(a).next().css("display","block"),$(a).next().children(".input-alasan").select()}function hideAlasanTolak(a){$(a).parent().css("display","none")}function getDiscussions(a){void 0===a&&(a=!1),a&&($(".discussions").html(""),setLoading(".section-3-content .default-empty-state"));var n={shipment_id:data_shipment_id};ajaxCall(getDiscussionsUrl,n,function(a){removeLoading(".section-3-content .default-empty-state"),addDiscussionToTable(jQuery.parseJSON(a))})}function addDiscussionToTable(a){for(var n=a.questions,t=n.length,i="",e=0;e<t;e++){var d=0==n[e].user_verified?"":"<span class='verified-icon' style='background-image: url("+verifiedIconUrl+");'><div></div></span>";i+="<div class='discussions-item'>",i+="<div class='questions' data-questions-id='"+n[e].questions_id+"'>",i+="<div class='questions-user-id'><a href='"+profilUrl+n[e].user_id+"'>"+n[e].username+"</a>"+d+"</div>",i+="<div class='questions-text'>"+n[e].questions_text+"</div>",btnJawabPertanyaan&&(i+="<button class='btn-neutral btn-jawab-pertanyaan'>Jawab</button>"),i+="<div class='discussion-item-time'>"+n[e].created_date+"</div>",i+="</div>";for(var s=a.answers[e],l=s.length,o=0;o<l;o++)i+="<div class='answers'>",i+="<div class='answers-user-id'><a href='"+profilUrl+shipment_user_id+"'>"+shipment_owner_username+"</a>"+verified_icon+"</div>",i+="<div class='answers-text'>"+s[o].answers_text+"</div>",i+="<div class='discussion-item-time'>"+s[o].created_date+"</div>",i+="</div>";btnJawabPertanyaan&&(i+="<div class='detail-jawab-pertanyaan'>",i+="<textarea class='input-jawab-pertanyaan'></textarea>",i+="<button class='btn-default btn-submit-jawab-pertanyaan'>Submit Jawaban</button>",i+="</div>",i+="</div>")}0==t?$(".section-3-content .default-empty-state").addClass("shown"):$(".section-3-content .default-empty-state").removeClass("shown"),$(".discussions").html(i)}function getBiddingList(a){void 0===a&&(a=!1),a&&($(".tbody-list-penawaran").html(""),setLoading(".table-list-penawaran-container .table-empty-state"));var n={shipment_id:data_shipment_id};ajaxCall(getBiddingListUrl,n,function(a){removeLoading(".table-list-penawaran-container .table-empty-state"),addBiddingListToTable(jQuery.parseJSON(a))})}function addBiddingListToTable(a){for(var n=a.data.length,t="",i=0;i<n;i++){var e="Darat";2==a.data[i].bidding_type&&(e="Laut");var d=0==a.data[i].user_verified?"":"<span class='verified-icon' style='background-image: url("+verifiedIconUrl+");'></span>";t+="<tr class='tr-bidding' data-status='"+a.data[i].bidding_status+"' data-bidding_id='"+a.data[i].bidding_id+"'>",t+="<td class='td-bidding-price' data-value='"+a.data[i].bidding_price+"'>"+addCommas(a.data[i].bidding_price)+" IDR</td>",t+="<td class='td-bidding-type' data-value='"+e+"'>"+e+"</td>",t+="<td class='td-bidding-username'><a href='"+profilUrl+a.data[i].user_id+"'>"+a.data[i].username+"</a>"+d+"</td>",t+="<td class='td-bidding-tanggal-ambil'>",t+="<div>Tanggal Ambil : "+a.data[i].bidding_pickupdate+"</div>",t+="<div>Keterangan : "+a.data[i].bidding_information+"</div>",null!==a.data[i].bidding_vehicle&&(t+="<div>Kendaraan : "+a.data[i].bidding_vehicle+"</div>"),t+="</td>",t+="<td>",1==a.data[i].bidding_status?t+="DITERIMA <span class='bidding-tanggal-batal'>"+a.data[i].modified_date+"</span>":2==a.data[i].bidding_status?t+="<div class='alasan-tolak'>DITOLAK <span class='bidding-tanggal-batal'>"+a.data[i].modified_date+"</span><br><strong>Alasan : </strong>"+a.data[i].bidding_reason+"</div>":-1==a.data[i].bidding_status?t+="DIBATALKAN <span class='bidding-tanggal-batal'>"+a.data[i].modified_date+"</span>":btnJawabPertanyaan?(t+="<button class='btn-default btn-setuju'>Setuju</button>",t+="<button class='btn-negative btn-tolak'>Tolak</button>",t+="<div class='container-tolak'>",t+="<textarea class='input-alasan' data-bidding_id='"+a.data[i].bidding_id+"'></textarea>",t+="<button class='btn-negative btn-submit-tolak' data-bidding_id='"+a.data[i].bidding_id+"'>Tolak</button>",t+="<button class='btn-neutral btn-batal-tolak'>Batal Tolak</button>",t+="</div>"):btnCancelBidding&&user_id==a.data[i].created_by&&(t+="<button class='btn-negative btn-cancel-bidding'>Batalkan</button>"),t+="</td>",t+="<td>"+a.data[i].created_date+"</td>",t+="</tr>"}0==n?$(".table-list-penawaran-container .table-empty-state").addClass("shown"):$(".table-list-penawaran-container .table-empty-state").removeClass("shown"),$(".tbody-list-penawaran").html(t),a.canBid&&$(".btn-tawar").prop("disabled",!1)}function initMap(){lat=location_from_lat,lng=location_from_lng,center_from={lat:lat,lng:lng},map=new google.maps.Map(document.getElementById("map_asal"),{scrollwheel:!1,disableDoubleClickZoom:!0,draggable:!1,panControl:!1,clickableIcons:!1,streetViewControl:!1,disableDefaultUI:!0}),marker_from=new google.maps.Marker({position:new google.maps.LatLng(location_from_lat,location_from_lng),map:map,icon:"https://maps.google.com/mapfiles/marker_greenA.png"}),marker_to=new google.maps.Marker({position:new google.maps.LatLng(location_to_lat,location_to_lng),map:map,label:"B"});var a=new google.maps.DirectionsService,n=new google.maps.DirectionsRenderer;n.setMap(map),n.setOptions({suppressMarkers:!0}),calculateAndDisplayRoute(a,n)}function calculateAndDisplayRoute(a,n){a.route({origin:new google.maps.LatLng(location_from_lat,location_from_lng),destination:new google.maps.LatLng(location_to_lat,location_to_lng),travelMode:"DRIVING"},function(a,t){if("OK"===t)n.setDirections(a);else if("ZERO_RESULTS"==t){var i=new google.maps.LatLngBounds;new google.maps.InfoWindow;i.extend(marker_from.position),i.extend(marker_to.position),map.fitBounds(i)}})}