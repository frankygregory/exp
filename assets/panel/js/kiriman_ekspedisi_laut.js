function getAllStatusKiriman(t,a){var s=$(t).data("id");ajaxCall(getAllStatusKirimanUrl,{shipment_id:s},function(t){var s=JSON.parse(t);if("success"==s.status){"Door 1","Port 1","Diambil","Door 2";var i="";i+="<div class='detail-status'>",i+="<div class='detail-status-title'>Status</div>",i+="<div class='status-item'><span class='status-badge' data-status='0'>Pending</span><span class='status-time'>"+s.pending_date+"</span></div>",i+='<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>',i+="<div class='status-item'><span class='status-badge' data-status='1'>Konfirmasi</span><span class='status-time'>"+s.confirmation_date+"</span></div>",i+='<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>',i+="<div class='status-item'><span class='status-badge' data-status='2'>Door 1</span><span class='status-time'>"+s.door_start_date+"</span></div>",i+='<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>',i+="<div class='status-item'><span class='status-badge' data-status='3'>Port 1</span><span class='status-time'>"+s.port_start_date+"</span></div>",i+='<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>',i+="<div class='status-item'><span class='status-badge' data-status='4'>Diambil</span><span class='status-time'>"+s.port_finish_date+"</span></div>",i+='<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>',i+="<div class='status-item'><span class='status-badge' data-status='5'>Door 2</span><span class='status-time'>"+s.door_finish_date+"</span></div>",i+='<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>',i+="<div class='status-item'><span class='status-badge' data-status='6'>Selesai</span><span class='status-time'>"+s.ending_date+"</span></div>",i+="</div>",$(a).find(".row-detail-td-content").html(i)}})}function getDetailPengirim(t){var a=$(t).data("id");ajaxCall(getDetailPengirimUrl,{shipment_id:a},function(a){var s=jQuery.parseJSON(a),i="";i+="<div class='detail-col'>",i+="<div class='detail-title'>Info Pemilik Barang</div>",i+="<div class='detail-row'><span class='detail-label'>Nama</span><span class='detail-titikdua'> : </span><span class='detail-value'>"+s.user_fullname+"</span></div>",i+="<div class='detail-row'><span class='detail-label'>Alamat</span><span class='detail-titikdua'> : </span><span class='detail-value'>"+s.user_address+"</span></div>",i+="<div class='detail-row'><span class='detail-label'>Telepon</span><span class='detail-titikdua'> : </span><span class='detail-value'>"+s.user_telephone+"</span></div>",i+="<div class='detail-row'><span class='detail-label'>Handphone</span><span class='detail-titikdua'> : </span><span class='detail-value'>"+s.user_handphone+"</span></div>",i+="</div>";var n,e,l,d,r=s.pending_date,o=s.confirmation_date;n=s.door_start_date,e=s.port_start_date,l=s.port_finish_date,d=s.door_finish_date,s.shipment_status>1&&(i+="<div class='detail-col'>",i+="<div class='detail-title'>Detail Kiriman</div>",i+="<div class='detail-row'><span class='detail-label'>No. Kontainer</span><span class='detail-titikdua'> : </span><span class='detail-value'>"+s.shipment_details_container_number+"</span></div>",i+="</div>"),i+="<div class='detail-status'>",i+="<div class='detail-status-title'>Status</div>",i+="<div class='status-item'><span class='status-badge' data-status='0'>Pending</span><span class='status-time'>"+r+"</span></div>",s.shipment_status>=1&&(i+='<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>',i+="<div class='status-item'><span class='status-badge' data-status='1'>Konfirmasi</span><span class='status-time'>"+o+"</span></div>"),s.shipment_status>=2&&(i+='<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>',i+="<div class='status-item'><span class='status-badge' data-status='2'>Door 1</span><span class='status-time'>"+n+"</span></div>"),s.shipment_status>=3&&(i+='<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>',i+="<div class='status-item'><span class='status-badge' data-status='3'>Port 1</span><span class='status-time'>"+e+"</span></div>"),s.shipment_status>=4&&(i+='<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>',i+="<div class='status-item'><span class='status-badge' data-status='4'>Port 2</span><span class='status-time'>"+l+"</span></div>"),s.shipment_status>=5&&(i+='<svg class="svg-right-arrow" version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 129 129" width="22" height="22" xmlns:xlink="http://www.w3.org/1999/xlink"><g><path d="m40.4,121.3c-0.8,0.8-1.8,1.2-2.9,1.2s-2.1-0.4-2.9-1.2c-1.6-1.6-1.6-4.2 0-5.8l51-51-51-51c-1.6-1.6-1.6-4.2 0-5.8 1.6-1.6 4.2-1.6 5.8,0l53.9,53.9c1.6,1.6 1.6,4.2 0,5.8l-53.9,53.9z"/></g></svg>',i+="<div class='status-item'><span class='status-badge' data-status='5'>Door 2</span><span class='status-time'>"+d+"</span></div>"),i+="</div>",$(t).next().find(".row-detail-td-content").html(i)})}function submitUbah(){var t=$(".dialog-konfirmasi-ubah").data("shipment_id"),a=$(".dialog-konfirmasi-ubah").data("shipment_status"),s=$(".dialog-konfirmasi-ubah").data("datetime"),i=$(".dialog-konfirmasi-ubah").data("shipment_details_container_number"),n=$(".dialog-konfirmasi-ubah").data("ship_id");showFullscreenLoading();var e={shipment_id:t,shipment_status:a,datetime:s,shipment_details_container_number:i,ship_id:n};ajaxCall(submitUbahUrl,e,function(t){hideFullscreenLoading(),"success"==t&&(closeDialog(),hideUbahDialog(),refreshData())})}function showUbahDialog(t){var a=$(t).closest(".tr-kiriman"),s=$(t).offset().top+$(t).outerHeight();$(".dialog-ubah").css({top:s});var i=$(a).data("status");$(".dialog-ubah").data("status",i);var n=!0;if(1==i){var e=$(a).find(".input-no-kontainer"),l=$(e).val().trim();if(""==l)n=!1,alert("Nomor Kontainer harus diisi"),$(e).select();else{var d=$(a).find(".select-kapal").val();$(".dialog-ubah").data("ship_id",d),$(".dialog-ubah").data("shipment_details_container_number",l)}}if(n){var r=$(a).data("id"),o=$(a).data("shipment-title");$(".dialog-ubah").data("id",r),$(".dialog-ubah").data("shipment_title",o);for(var c=2;c<=i;c++)$(".dialog-ubah-button[data-value='"+c+"']").prop("disabled",!0);$(".dialog-ubah-button[data-value='"+(i+1)+"']").click();var u=new Date,h=u.getMonth()+1+"";h=1==h.length?"0"+h:h;var g=u.getDate()+"";g=1==g.length?"0"+g:g;var m=u.getHours()+"";m=1==m.length?"0"+m:m;var p=u.getMinutes()+"";p=1==p.length?"0"+p:p;var b=g+"-"+h+"-"+u.getFullYear()+" "+m+":"+p;$(".dialog-ubah-input-waktu").val(b),$(".dialog-ubah").css("display","block")}}function hideUbahDialog(){$(".dialog-ubah").css("display","none")}function cancelShipment(){showFullscreenLoading();var t=$(".dialog-konfirmasi-cancel-transaction").data("shipment_id");ajaxCall(cancelShipmentUrl,{shipment_id:t},function(t){hideFullscreenLoading(),"success"==t&&(closeDialog(),refreshData())})}function submitDeal(t){var a={shipment_id:$(t).closest(".tr-kiriman").data("id")};ajaxCall(submitDealUrl,a,function(t){"success"==t?refreshData():alert(t)})}function refreshData(){var t=$(".tabs-item.active").data("tabs-number");getKiriman(kirimanUrl[t],t,kirimanTabs[t]),getKirimanCount()}function getKirimanCount(){ajaxCall(getKirimanCountUrl,null,function(t){assignKirimanCount(jQuery.parseJSON(t))})}function assignKirimanCount(t){for(var a={t1:0,t2:0,t3:0,t4:0,t5:0,t6:0,t7:0,t8:0},s=0;s<t.length;s++)switch(t[s].shipment_status){case"0":a.t1=t[s].count;break;case"1":a.t2=t[s].count;break;case"2":a.t3=t[s].count;break;case"3":a.t4=t[s].count;break;case"4":a.t5=t[s].count;break;case"5":a.t6=t[s].count;break;case"6":a.t7=t[s].count;break;case"7":a.t8=t[s].count}for(s=1;s<=8;s++)updateTabsItemCount(s,a["t"+s])}function getKiriman(t,a,s){abortAjaxCall(),$(".tabs-content[data-tabs-number='"+a+"'] .tbody-kiriman").html(""),setLoading(".tabs-content[data-tabs-number='"+a+"'] .table-empty-state"),ajaxCall(t,null,function(t){removeLoading(),addKirimanToTable(jQuery.parseJSON(t),a,s)})}function addKirimanToTable(t,a,s){for(var i=t.length,n={deal:{value:"",btn:"<td><button class='btn-default btn-deal'>Deal</button><button class='btn-negative btn-batal-pengiriman'>Tolak</button></td>"},pending:{value:"",btn:"<td><button class='btn-default btn-ubah'>Ubah</button><button class='btn-negative btn-batal-pengiriman'>Batalkan</button></td>"},door1:{value:"",btn:"<td><button class='btn-default btn-ubah'>Ubah</button></td>"},port1:{value:"",btn:"<td><button class='btn-default btn-ubah'>Ubah</button></td>"},port2:{value:"",btn:"<td><button class='btn-default btn-ubah'>Ubah</button></td>"},door2:{value:"",btn:""},selesai:{value:"",btn:""},cancel:{value:"",btn:""}},e=0;e<i;e++){var l=new Date(t[e].shipment_delivery_date_from),d=l.getDate()+" "+month[l.getMonth()]+" "+l.getFullYear().toString().substring(2),r=new Date(t[e].shipment_delivery_date_to),o=r.getDate()+" "+month[r.getMonth()]+" "+r.getFullYear().toString().substring(2),c=""==t[e].shipment_pictures?"default.gif":t[e].shipment_pictures,u="",h="",g="",m="",p="<button class='btn-default btn-view-kontak'>Info Kiriman</button>";switch(s){case"deal":p="";break;case"pending":u="<td><select class='select-kapal'><option value='1'>Meratus</option><option value='2'>SPIL</option></select></td><td><input type='text' class='input-no-kontainer' maxlength='11' /></td>",h="<td>D1 &rarr; P1 &rarr; P2 &rarr; D2</td>";break;case"door1":u="<td>"+t[e].ship_id+"</td><td>"+t[e].shipment_details_container_number+"</td>",h="<td><strong>D1</strong> &rarr; P1 &rarr; P2 &rarr; D2</td>";break;case"port1":u="<td>"+t[e].ship_id+"</td><td>"+t[e].shipment_details_container_number+"</td>",h="<td><strong>D1 &rarr; P1</strong> &rarr; P2 &rarr; D2</td>";break;case"port2":u="<td>"+t[e].ship_id+"</td><td>"+t[e].shipment_details_container_number+"</td>",h="<td><strong>D1 &rarr; P1 &rarr; P2</strong> &rarr; D2</td>";break;case"door2":u="<td>"+t[e].ship_id+"</td><td>"+t[e].shipment_details_container_number+"</td>",h="<td><strong>D1 &rarr; P1 &rarr; P2 &rarr; D2</strong></td>";break;case"selesai":u="<td>"+t[e].ship_id+"</td><td>"+t[e].shipment_details_container_number+"</td>",h="<td><strong>D1 &rarr; P1 &rarr; P2 &rarr; D2</strong></td>",m="<td data-align='center'>"+t[e].total_waktu+" hari</td>";break;case"cancel":p="";var b=0==t[e].user_verified?"":"<span class='verified-icon' style='background-image: url("+verifiedIconUrl+");'><div></div></span>";g="<td class='td-cancel_by'><a href='"+profilUrl+t[e].cancel_by+"'>"+t[e].cancel_username+b+"</a></td>"}n[s].value+="<tr class='tr-kiriman' data-id='"+t[e].shipment_id+"' data-shipment-title='"+t[e].shipment_title+"' data-status='"+t[e].shipment_status+"'><td class='td-title'><a href='"+shipmentUrl+t[e].shipment_id+"'><img class='shipment-picture' src='"+shipmentPictureUrl+c+"' onerror='this.onerror=null; this.src=\""+defaultPictureUrl+"\";' /><span>"+t[e].shipment_title+"</span></a></td><td class='td-price'>Bid : "+t[e].bidding_count+"<br>Low : "+addCommas(t[e].low)+" IDR"+p+"</td><td class='td-asal'>"+t[e].location_from_city+"<br>"+d+" - "+o+"</td><td class='td-tujuan'>"+t[e].location_to_city+"<br>"+d+" - "+o+"</td><td class='td-km' data-align='center'>"+parseInt(t[e].shipment_length)+"</td>"+g+u+h+n[s].btn+m+"</tr>",n[s].value+="<tr class='row-detail-tr'><td class='row-detail-td' colspan='20'><div class='row-detail-td-content'></div></td></tr>"}0==i?$(".tabs-content[data-tabs-number='"+a+"'] .table-empty-state").addClass("shown"):$(".tabs-content[data-tabs-number='"+a+"'] .table-empty-state").removeClass("shown"),$(".tabs-content[data-tabs-number='"+a+"'] .tbody-kiriman").html(""),$(".tabs-content[data-tabs-number='"+a+"'] .tbody-kiriman").append(n[s].value),"pending"==s&&i>0&&getKendaraan()}$(function(){getKiriman(kirimanUrl[1],1,"deal"),getKirimanCount(),$(".tabs-item").on("click",function(){var t=$(this).data("tabs-number");getKiriman(kirimanUrl[t],t,kirimanTabs[t])}),$(document).on("click",".btn-deal",function(){submitDeal(this)}),$(".dialog-ubah-input-waktu").datepicker({disableDateAfter:new Date}),$(document).on("click",".btn-ubah",function(t){t.stopPropagation(),showUbahDialog(this)}),$("body").on("click",function(t){0==$(t.target).closest(".dialog-ubah").length&&0==$(t.target).closest(".datepicker").length&&0==$(t.target).closest(".dialog-konfirmasi-ubah").length&&hideUbahDialog()}),$(document).on("click",".btn-batal-pengiriman",function(){var t=$(this).closest(".tr-kiriman").data("id"),a=$(this).closest(".tr-kiriman").data("shipment-title");$(".dialog-konfirmasi-cancel-transaction").data("shipment_id",t),$(".dialog-konfirmasi-cancel-transaction .dialog-body").html("Batalkan kiriman "+a+"?"),showDialog(".dialog-konfirmasi-cancel-transaction")}),$(".btn-ubah2").on("click",function(){var t=$(".dialog-ubah").data("id"),a=$(".dialog-ubah").data("shipment_title"),s=$(".dialog-ubah-input-status-value").val(),i=$(".dialog-ubah-input-status").val(),n=$(".dialog-ubah-input-waktu").val(),e=$(".dialog-ubah").data("shipment_details_container_number"),l=$(".dialog-ubah").data("ship_id");$(".dialog-konfirmasi-ubah").data("shipment_id",t),$(".dialog-konfirmasi-ubah").data("shipment_status",s),$(".dialog-konfirmasi-ubah").data("datetime",n),$(".dialog-konfirmasi-ubah").data("shipment_details_container_number",e),$(".dialog-konfirmasi-ubah").data("ship_id",l),$(".dialog-konfirmasi-ubah .value[data-label='nama']").html(a),$(".dialog-konfirmasi-ubah .value[data-label='status']").html(i),$(".dialog-konfirmasi-ubah .value[data-label='tanggal']").html(n),showDialog(".dialog-konfirmasi-ubah")}),$(".btn-submit-ubah").on("click",function(){submitUbah()}),$(".btn-submit-cancel-transaction").on("click",function(){cancelShipment()}),$(".dialog-ubah-button").on("click",function(){var t=$(this).data("text"),a=$(this).data("value");$(".dialog-ubah-input-status").val(t),$(".dialog-ubah-input-status-value").val(a)}),$(document).on("click",".tabs-content:not([data-tabs-number='7']):not([data-tabs-number='8']) .btn-view-kontak",function(){var t=$(this).closest(".tr-kiriman"),a=$(t).next();0==$(a).height()?($(a).addClass("show"),""==$(a).find(".row-detail-td-content").html().trim()&&getDetailPengirim(t)):$(a).removeClass("show")}),$(document).on("click",".tabs-content[data-tabs-number='7'] .btn-view-kontak",function(){var t=$(this).closest(".tr-kiriman"),a=$(t).next();0==a.height()?(a.addClass("show"),""==a.find(".row-detail-td-content").html().trim()&&getAllStatusKiriman(t,a)):a.removeClass("show")})});