function setActiveDatalistItem(t,a){var e=$(t).next(),i=$(e).find(".datalist-item").length;if(i>0){var n=parseInt($(e).find(".datalist-item.active").data("index"))||0;(n+=a)<=0?n=1:n>=i&&(n=i),$(e).find(".datalist-item.active").removeClass("active"),$(e).find(".datalist-item[data-index='"+n+"']").addClass("active")}}function scrollDownEvent(){$(this).scrollTop()>=sectionPosition&&($(".section, .table-kiriman").addClass("fixed"),$(".section").css("top",headerHeight),$(".table-kiriman thead").css("top",headerHeight+sectionHeight),$(this).off("scroll"),$(this).on("scroll",scrollUpEvent))}function scrollUpEvent(){$(this).scrollTop()<=sectionPosition&&($(".section, .table-kiriman").removeClass("fixed"),$(this).off("scroll"),$(this).on("scroll",scrollDownEvent))}function getKota(t,a){var e={fromto:t,keyword:a};ajaxCall(getKotaUrl,e,function(a){var e=jQuery.parseJSON(a),i="",n=e.length;if(n>0)for(var o=0;o<n;o++)i+="<div class='datalist-item "+t+"-city-dropdown-item' data-fromto='"+t+"' data-index='"+(o+1)+"'>"+e[o].city+"</div>";else i+="<div class='datalist-empty-state'>Tidak ada hasil</div>";$("."+t+"-city-dropdown").html(i),showDatalist(t)})}function showDatalist(t){$("."+t+"-city-dropdown").css("display","block")}function hideDatalist(){$(".datalist").css("display","none")}function scrollToTop(){$(".container-content").length>0?$(".container-content").scrollTop(0):$(document).scrollTop(0)}function getKiriman(t){void 0===t&&(t=!1),abortAjaxCall(),$(".tbody-kiriman").html(""),setLoading(".table-empty-state");var a=parseInt($(".input-jarak-max").val())||0,e=$(".select-sort").val(),i=$(".input-kota-asal").val(),n=$(".input-kota-tujuan").val(),o=parseInt($(".select-view-per-page").val()),s=1;if(t){s=parseInt($(".page-number-item.current-page-number").data("value"));var r=parseInt($(".available-pages").data("value"));s==r?disableNextPage():enableNextPage(),s>1?enablePrevPage():disablePrevPage()}var l={keyword_from:i,keyword_to:n,shipment_length_max:a,order_by:e,view_per_page:o,page:s,change_page:t};ajaxCall(getKirimanUrl,l,function(a){removeLoading();var e=jQuery.parseJSON(a);if(scrollToTop(),!t){var i=e.count;setAvailablePages(i,o)}var n=(s-1)*o+1,r=n+o-1;r>(i=parseInt($(".result-count").html()))&&(r=i),$(".result-paging").html(n+" - "+r),$(".tbody-kiriman").html("");for(var l=e.data.length,c=0;c<l;c++)addKirimanToTable(c+1,e.data[c]);0==l?$(".table-empty-state").addClass("shown"):$(".table-empty-state").removeClass("shown")})}function addKirimanToTable(t,a){var e=new Date(a.shipment_delivery_date_from),i=e.getDate()+" "+month[e.getMonth()]+" "+e.getFullYear().toString().substring(2,4),n=new Date(a.shipment_delivery_date_to),o=n.getDate()+" "+month[n.getMonth()]+" "+n.getFullYear().toString().substring(2,4),s=""==a.shipment_pictures?"default.gif":a.shipment_pictures,r="<tr class='tr-kiriman' data-id='"+a.shipment_id+"'><td class='td-title' data-col='nama-kirim'><a href='"+shipmentUrl+a.shipment_id+"'><img class='shipment-picture' src='"+shipmentPictureUrl+s+"' onerror='this.onerror=null; this.src=\""+defaultPictureUrl+"\";' /><span>"+a.shipment_title+"</span></a></td><td class='td-price' data-col='harga'>Bid : "+a.bidding_count+"<br>Low : "+addCommas(a.low)+" IDR</td><td class='td-asal' data-col='asal'>"+a.location_from_city+"<br>"+i+" - "+o+"</td><td class='td-tujuan' data-col='tujuan'>"+a.location_to_city+"<br>"+i+" - "+o+"</td><td class='td-km' data-col='km'>"+parseInt(a.shipment_length)+"</td><td class='td-berakhir' data-col='berakhir'>"+a.berakhir+"</td></td></tr>";$(".tbody-kiriman").append(r)}var month=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],headerHeight,sectionHeight,sectionTop,sectionPosition,theadHeight,tbodyTop,tbodyPosition,alreadyRefresh=!1;$(function(){headerHeight=$(".header").length>0?parseInt($(".header").css("height"))||0:parseInt($(".navigation-header").css("height"))||0,sectionHeight=parseInt($(".section").css("height"))||0,sectionTop=$(".section").offset().top,sectionPosition=sectionTop-headerHeight,theadHeight=parseInt($(".table-kiriman thead").css("height"))||0,tbodyTop=$(".table-kiriman tbody").offset().top,tbodyPosition=tbodyTop-headerHeight-theadHeight-sectionHeight,getKiriman(),$(".container-content").length>0?$(".container-content").on("scroll",scrollDownEvent):$(document).on("scroll",scrollDownEvent),$(".select-sort").on("change",function(){getKiriman()}),$(".input-kota-asal").on("input",function(){getKota("from",$(this).val())}),$(".input-kota-tujuan").on("input",function(){getKota("to",$(this).val())}),$(".input-kota-asal, .input-kota-tujuan, .input-jarak-max").on("keypress",function(t){if(13==t.which){var a=$(this).next().find(".datalist-item.active");a.length>0?$(a).mousedown():$(this).blur()}}),$(".input-kota-asal, .input-kota-tujuan").on("keydown",function(t){40==t.which?setActiveDatalistItem(this,1):38==t.which&&setActiveDatalistItem(this,-1)}),$(".input-kota-asal, .input-kota-tujuan").on("focusout",function(){hideDatalist(),alreadyRefresh?alreadyRefresh=!1:getKiriman()}),$(".input-jarak-slider").on("input",function(){var t=$(this).val();$(".input-jarak-max").val(t)}),$(".input-jarak-slider").on("change",function(){getKiriman()}),$(".input-jarak-max").on("change",function(t){var a=$(this).val();$(".input-jarak-slider").val(a),getKiriman()}),$(".input-jarak-max").on("change",function(){parseInt($(this).val())>5e3&&$(this).val("5000")}),$(".input-jarak-max").on("keydown",function(t){isNumber(t)}),$(document).on("click",function(t){0==$(t.target).closest(".datalist").length&&hideDatalist()}),$(document).on("mousedown",".datalist-item",function(){alreadyRefresh=!0;var t=$(this).html(),a=$(this).data("fromto");$(".input-kota-"+a).val(t),hideDatalist(),$(this).parent().prev().blur(),getKiriman()}),$("td[data-sortable='true']").on("click",function(){$(this).data("col");var t=$(this).data("sort-value");t=""==t||"desc"==t?"asc":"desc"}),$(".select-view-per-page").on("change",function(){getKiriman()}),paginationCallback=function(){getKiriman(!0)}});