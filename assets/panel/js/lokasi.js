function deleteLocation(){showFullscreenLoading();var t=$(".dialog-konfirmasi-delete").data("id");ajaxCall("lokasi/deleteLocation",{location_id:t},function(){hideFullscreenLoading(),closeDialog(),getMyLocation()})}function updateLocation(){var t=$(".dialog-tambah").data("id"),a=$("#location_name").val(),o=$("#location_city").val(),l=$("#location_address").val(),i=$("#location_detail").val(),n=$("#location_contact").val(),e=$("#location_latlng").val(),c=0,s=0;if($("#location_from").is(":checked")&&(c=1),$("#location_to").is(":checked")&&(s=1),clearErrors(),cekInputError(l,e,i,n)){showFullscreenLoading();var d={location_id:t,location_name:a,location_city:o,location_address:l,location_detail:i,location_contact:n,location_latlng:e,location_from:c,location_to:s};ajaxCall("lokasi/updateLocation",d,function(t){hideFullscreenLoading(),closeDialog(),getMyLocation()})}}function cekInputError(t,a,o,l){var i=!0;return""==t?(i=!1,$("#location_address").next().html("Nama lokasi harus diisi")):"0, 0"==a&&(i=!1,$("#location_address").next().html("Lokasi harus dipilih dari google maps")),""==o&&(i=!1,$("#location_detail").next().html("Detail lokasi harus diisi")),""==l&&(i=!1,$("#location_contact").next().html("Kontak harus diisi")),i}function clearErrors(){$(".error").html("")}function addLocation(){var t=$("#location_name").val(),a=$("#location_address").val().trim(),o=$("#location_city").val(),l=$("#location_latlng").val(),i=$("#location_detail").val().trim(),n=$("#location_contact").val().trim(),e=0,c=0;if($("#location_from").is(":checked")&&(e=1),$("#location_to").is(":checked")&&(c=1),clearErrors(),cekInputError(a,l,i,n)){showFullscreenLoading();var s={location_name:t,location_address:a,location_city:o,location_latlng:l,location_detail:i,location_contact:n,location_from:e,location_to:c};ajaxCall("lokasi/addLocation",s,function(t){hideFullscreenLoading();var a=jQuery.parseJSON(t);"success"==a.status?(getMyLocation(),closeDialog()):"duplicate"==a.status_message?alert("Lokasi ini sudah ada di daftar"):closeDialog()})}}function getMyLocation(){$(".tbody-lokasi").html(""),setLoading(".table-empty-state"),ajaxCall("lokasi/getMyLocation",null,function(t){removeLoading(),addLocationToTable(jQuery.parseJSON(t))})}function addLocationToTable(t){for(var a="",o=t.length,l=0;l<o;l++){var i="Ya",n="Ya";0==t[l].location_from&&(i="Tidak"),0==t[l].location_to&&(n="Tidak");var e="<button class='btn-action btn-edit' title='edit' style='background-image: url("+editIconUrl+");'></button>",c="<button class='btn-action btn-delete' title='delete' style='background-image: url("+deleteIconUrl+");'></button>";a+="<tr class='tr-lokasi' data-id='"+t[l].location_id+"' data-lat='"+t[l].location_lat+"' data-lng='"+t[l].location_lng+"' data-city='"+t[l].location_city+"'>",a+="<td data-align='center'>"+(l+1)+"</td>",a+="<td class='td-location_name'>"+t[l].location_name+"</td>",a+="<td class='td-location_address'>"+t[l].location_address+"</td>",a+="<td class='td-location_detail'>"+t[l].location_detail+"</td>",a+="<td class='td-location_contact'>"+t[l].location_contact+"</td>",a+="<td class='td-location_asal' data-align='center'>"+i+"</td>",a+="<td class='td-location_tujuan' data-align='center'>"+n+"</td>",a+="<td data-align='center'>"+e+c+"</td>",a+="</tr>"}0==o?$(".table-empty-state").addClass("shown"):$(".table-empty-state").removeClass("shown"),$(".tbody-lokasi").html(a)}function updatePosition(t,a,o){$("#"+t).val(a+", "+o)}function initialize(){input=document.getElementById("location_address"),(autocomplete=new google.maps.places.Autocomplete(input)).addListener("place_changed",function(){var t=autocomplete.getPlace(),a="",o=t.address_components;for(var l in o)if(o.hasOwnProperty(l)){var i=o[l].types;for(var n in i)"administrative_area_level_2"==i[n]&&(a=o[l].long_name)}$("#location_name").val(t.name),$("#location_city").val(a),get_lat_long("location",t.geometry.location,"location_latlng")})}function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:center,streetViewControl:!1,disableDefaultUI:!0,zoom:17}),marker=new google.maps.Marker({position:center,draggable:!0,map:map}),google.maps.event.addListener(marker,"dragend",function(){map.setCenter(this.getPosition()),updatePosition("location_latlng",this.getPosition().lat(),this.getPosition().lng()),latlng={lat:parseFloat(this.getPosition().lat()),lng:parseFloat(this.getPosition().lng())},(new google.maps.Geocoder).geocode({location:latlng},function(t,a){"OK"===a?t[1]?$("#location_address").val(t[0].formatted_address):window.alert("No results found"):window.alert("Geocoder failed due to: "+a)})}),updatePosition("location_latlng",center.lat,center.lng),google.maps.event.addDomListener(window,"load",initialize)}function get_lat_long(t,a,o){var l,i;"location"==t?(l=a.lat(),i=a.lng()):"address"==t&&(new google.maps.Geocoder).geocode({address:a},function(t,a){l=1*t[0].geometry.location.lat(),i=1*t[0].geometry.location.lng(),$("#"+o).val(l+", "+i),setMarkerFromLatlng()}),$("#"+o).val(l+", "+i),setMarkerFromLatlng()}function setMarkerFromLatlng(){latlng=$("#location_latlng").val(),lat=latlng.substring(0,latlng.indexOf(",")),lng=latlng.substring(latlng.indexOf(" "),latlng.length-1),marker.setPosition(new google.maps.LatLng(lat,lng)),map.panTo(new google.maps.LatLng(lat,lng))}var map,marker,autocomplete,lat,lng,center={lat:0,lng:0};$(function(){getMyLocation(),$(".btn-tambah").on("click",function(){$(".dialog-tambah .dialog-title").html("Tambah Lokasi"),$(".dialog-tambah .btn-submit-tambah").css("display","block"),$(".dialog-tambah .btn-submit-edit").css("display","none"),$(".dialog-tambah .btn-batal").css("display","none"),clearErrors(),showDialog(".dialog-tambah"),$(".dialog-tambah .input-nama").select(),google.maps.event.trigger(map,"resize")}),$(".btn-submit-tambah").on("click",function(){addLocation()}),$(document).on("click",".btn-edit",function(){$(".dialog-tambah .dialog-title").html("Edit Lokasi"),$(".dialog-tambah .btn-submit-tambah").css("display","none"),$(".dialog-tambah .btn-submit-edit").css("display","block"),$(".dialog-tambah .btn-batal").css("display","block");var t=$(this).closest(".tr-lokasi").data("id"),a=$(this).closest(".tr-lokasi").data("city"),o=$(this).closest(".tr-lokasi").find(".td-location_name").html(),l=$(this).closest(".tr-lokasi").find(".td-location_address").html(),i=$(this).closest(".tr-lokasi").find(".td-location_detail").html(),n=$(this).closest(".tr-lokasi").find(".td-location_contact").html(),e=$(this).closest(".tr-lokasi").data("lat"),c=$(this).closest(".tr-lokasi").data("lng"),s=!0;"Tidak"==$(this).closest(".tr-lokasi").find(".td-location_asal").html()&&(s=!1);var d=!0;"Tidak"==$(this).closest(".tr-lokasi").find(".td-location_tujuan").html()&&(d=!1),$(".dialog-tambah").data("id",t),$("#location_city").val(a),$("#location_address").val(l),$("#location_latlng").val(e+", "+c),$("#location_name").val(o),$("#location_detail").val(i),$("#location_contact").val(n),$("#location_from").prop("checked",s),$("#location_to").prop("checked",d),showDialog(".dialog-tambah"),google.maps.event.trigger(map,"resize"),setMarkerFromLatlng()}),$(".btn-submit-edit").on("click",function(){updateLocation()}),$(document).on("click",".btn-delete",function(){var t=$(this).closest(".tr-lokasi").children(".td-location_name").html(),a=$(this).closest(".tr-lokasi").data("id");$(".dialog-konfirmasi-delete").data("id",a),$(".dialog-konfirmasi-delete .dialog-body").html("Delete "+t+"?"),showDialog(".dialog-konfirmasi-delete")}),$(".btn-submit-delete").on("click",function(){deleteLocation()})});